$.widget("ibm.chatwidget",{options:{name:"¡Hola! Soy Juanita",avatarImage:"https://widget-chatbot-colombia.mybluemix.net/anita/images/avatar_co-original.png",iniciado:0,idmensaje:0,idcarrusel:0,idcarrusel_opciones:0,idFormPuntos:0,calificion:0,idChatActual:0},_create:function(){this._avatar=$('<div class="dragable" id="dragable" style="cursor: pointer;"><div id="ChatAvatarDiv" class="chat-widget-avatar"><img class="Img-avatar" src=" https://widget-chatbot-colombia.mybluemix.net/anita/images/avatar_co-original.png"><div id="msg"></div></div></div>'),this._messageAvatar=$('<img class="chat-widget-avatar-message" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/avatar_co-original.png">'),this._messageContainer=$('<div class="chat_widget-message-container"></div>'),this._panel=$('<div class="chat-widget-panel"></div>'),this._header=$('<div class="chat-widget-header"></div>'),this._messageLog=$('<div id="style-3" class="chat-widget-message-log"><div class="style-2"></div></div>'),this._messageDock=$('<div class="chat-widget-message-dock"></div>'),this._assistantStatus=$('<img class="anitaImg ima-responsive hidden-xs" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/avatar_co-original.png"> \t\t\t\t<div style="display: flex;flex-direction: column;margin-right:9px;">    <span class="chat-widget-assistant-name">'+this.options.name+'</span> \t\t\t\t<span style="font-size: 10px;color: #ffffff;display: flex;justify-content: left;margin-top: 0; text-transform: uppercase;">Tu Robot Virtual de Jumbo</span> \t\t\t\t </div> \t\t\t\t'),this._headerButtons=$('<div style="" class="chat-widget-header-buttons"><a class="close-button"><i class="fa fa-times" aria-hidden="true"></i></a></div>'),this._messageInput=$('<input type="text" placeholder="Escribe un mensaje..." rows="3" data-min-rows="3" class="autoExpand chat-widget-message-input" autocomplete="off"/>'),this._messageSubmitButton=$('<button type="submit"><i class="fa fa-paper-plane" style="font-size:15px;color:#323232" aria-hidden="true"></i></button>'),this._header.append(this._assistantStatus,this._headerButtons),this._messageDock.append(this._messageInput,this._messageSubmitButton),this._panel.append(this._header,this._messageLog,this._messageDock),this.element.append(this._panel,this._avatar),Draggable.create("#dragable",{onClick:function(){},onDragStart:function(e){$("#dragable").addClass("dragging")},onDragEnd:function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),$("#dragable").removeClass("dragging")}}),$(document).on("click","#dragable.dragging",function(){e.stopPropagation(),e.preventDefault(),alert("native click")}),function e(){$(function(){var e=window.location.pathname,t=navigator.userAgent||navigator.vendor||window.opera,i=0,s=0;-1!=e.indexOf("cart")&&(i=1),-1!=e.indexOf("checkout")&&(s=1),-1!=$(".minicart__totalizer--amount span").text().indexOf("0")?1==i||1==s?(console.log("entro al if carrito"),(t.match(/Android/i)||/iPhone/.test(t))&&($("#chat-widget").css("cssText","bottom: 2% !important;"),$("#chat-widget").css("left","4%"),$("#chat-widget").css("align-items","end"))):(t.match(/Android/i)||/iPhone/.test(t),$("#chat-widget").css("cssText","bottom: 5% !important;"),$("#chat-widget").css("right","2%"),$("#chat-widget").css("align-items","flex-end")):(t.match(/Android/i)||/iPhone/.test(t)?($("#chat-widget").css("cssText","bottom: 2% !important;"),$("#chat-widget").css("left","4%"),$("#chat-widget").css("align-items","end")):($("#chat-widget").css("cssText","bottom: 5% !important;"),$("#chat-widget").css("right","2%"),$("#chat-widget").css("align-items","flex-end")),/iPhone/.test(navigator.userAgent))}),setTimeout(e,1e3)}(),this.element.addClass("chat-widget"),this._panel.hide(),this._is_active=!1;var t=this;$(".chatHumanoBtn").on("click",function(){t.sendMessage("Agente Jumbo","opcion")}),$(function(){if(!$.support.placeholder){var e=document.activeElement;$(".chat-widget-message-input").focus(function(){""!=$(this).attr("placeholder")&&$(this).val()==$(this).attr("placeholder")&&$(this).attr("placeholder","")}).blur(function(){$(this).attr("placeholder","Escribir un Mensaje...")}),$(".chat-widget-message-input").blur(),$(e).focus(),$("form").submit(function(){$(this).attr("placeholder","")})}}),t.bindEvent(window,"message",function(e){"inicioInconcert"==e.data&&t._removeChat(),"cerrarChat"==e.data&&($("#loadinginconcertChat").remove(),$(".fixClose").remove(),$("#transferidoDiv").html("Transferido"),t._guardarEnBase("historial",'message=<div class="chat-widget-message-container"><div class="chat-widget-message received">Espero te hayan podído ayudar. Voy a seguir entrenandome con este tema para intentar ayudarte la próxima vez. Cualquier otra cosa puedes escribirme</div></div><div class="chat-widget-message-container"><p class="timerecived">'+t.getCurrentTime()+"</p></div>"),t._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">Espero te hayan podído ayudar. Voy a seguir entrenandome con este tema para intentar ayudarte la próxima vez. Cualquier otra cosa puedes escribirme</div></div>'),t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived">'+t.getCurrentTime()+"</p></div>"),t._shouldScroll()||t._scrollToBottom(),t._restartChat())}),t.options.idmensaje++,this._on(this.element,{"click .chat-widget-avatar":function(){this._toggleChat()},"click .chat-widget-header-buttons .close-button":function(){this._cerrarChat()},"click .chat-widget-header-buttons #cerrar-chat-button":function(){this._hideChat()},"click #cerrar-chat-button":function(){this._hideChat(),$(".calificar-cerrar").remove()},'click button[type="submit"]':function(){this._submitMessage()},"keyup .chat-widget-message-input":function(e){13==e.keyCode&&this._submitMessage()}}),this.element.one("focus.autoExpand","textarea.autoExpand",function(){var e=this.value;this.value="",this.baseScrollHeight=this.scrollHeight,this.value=e}).on("input.autoExpand","textarea.autoExpand",function(){var e,t=0|this.getAttribute("data-min-rows");this.rows=t,e=Math.ceil((this.scrollHeioptionght-this.baseScrollHeight)/17),this.rows=t+e}),this._scrollToBottom()},_toggleChat:function(){this._is_active?this._hideChat():this.showChat()},prueba:function(){alert("prueba")},showChat:function(){if(0==this.options.iniciado){this._guardarEnBase("iniciar"),this.options.iniciado=1,this._socket=new WebSocket("wss://chatbot-colombia-red-dev.mybluemix.net/ws/jumbo");var e=this;this._socket.onopen=function(){console.log("Connected"),function t(){e._socket.readyState==e._socket.OPEN&&e._socket.send(JSON.stringify({type:"command",message:"/keepalive"})),setTimeout(t,3e4)}()},this._socket.onmessage=function(t){var i=JSON.parse(t.data);console.log(i),"message"==i.type?(e.receiveMessage(i.message),i.message=i.message.toUpperCase(),i.message):"command"==i.type&&"escribiendo"==i.command&&e._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>')},this._socket.onclose=function(){option,console.log("Disconnected")}}var t;this._panel.show("fade",200).css("display","flex"),this._is_active=!0,this._avatar.hide(),"undefined"!=typeof dataLayer&&(console.log(dataLayer),dataLayer.push({event:"chatIniciado"})),t=navigator.userAgent||navigator.vendor||window.opera,/iPad|iPhone|iPod/.test(t)&&!window.MSStream&&$("meta[name=viewport]").attr("content","width=device-width,initial-scale=1,maximum-scale=1.0"),$(".style-2").fadeOut(4e3)},_hideChat:function(){var e,t=this;this._avatar.show("fade",200),t._panel.hide("fade",200,function(){t._is_active=!1}),e=navigator.userAgent||navigator.vendor||window.opera,/iPad|iPhone|iPod/.test(e)&&!window.MSStream&&$("meta[name=viewport]").attr("content","width=device-width,initial-scale=1.0")},_cerrarChat:function(){self=this;var e="",t="";"undefined"!=typeof dataLayer&&void 0!==dataLayer[3]&&void 0!==dataLayer[3].visitorContactInfo&&(void 0!==dataLayer[3].visitorContactInfo[1]&&""!=dataLayer[3].visitorContactInfo[1]&&(e=dataLayer[3].visitorContactInfo[1]),void 0!==dataLayer[3].visitorContactInfo[2]&&""!=dataLayer[3].visitorContactInfo[2]&&(e+=" "+dataLayer[3].visitorContactInfo[2]),void 0!==dataLayer[3].visitorContactInfo[0]&&""!=dataLayer[3].visitorContactInfo[0]&&(t=dataLayer[3].visitorContactInfo[0])),$(".chat-widget-panel").append('<div  class="calificar-cerrar" id="calificar-cerrar"><div style="" class="chat-widget-message-container"><div class="chat-widget-message received"><fieldset style="margin-bottom: 10px; text-align:center;" class="rating2"><legend style="padding-bottom:10px; width:100%; text-align: center;">Quisieras colaborar con mi entrenamiento? Como calificarías mi atención?</legend><leyend id="noCalifico" style="color:red;clear:both;width:100%;float:left;display:none;">Favor selecciona tu calificación</leyend><span class="rating2"><input type="radio" id="cal5" name="rating2" value="5" /><label for="cal5" title="Genial!">5 Estrellas</label><input type="radio" id="cal4" name="rating2" value="4" /><label for="cal4" title="Muy buena">4 Estrellas</label>    <input type="radio" id="cal3" name="rating2" value="3" /><label for="cal3" title="Buena">3 Estrellas</label>    <input type="radio" id="cal2" name="rating2" value="2" /><label for="cal2" title="Algo ayudo">2 Estrellas</label>    <input type="radio" id="cal1" name="rating2" value="1" /><label for="cal1" title="Perdida de tiempo">1 Estrella</label></span></fieldset><div class="linea"></div><div class="flex-container"><a class="btn-no-gracias" id="cerrar-chat-button" tabindex="0"><strong>No gracias</strong></a></div><div id="divAdicionalRating2" style="display:none"><input style="width:100%;padding:4px;margin-top:4px;padding-left:15px" name="nombre" placeholder="Nombre*" value="'+e+'"/><input style="width:100%;padding:4px;margin-top:4px;padding-left:15px" name="email" placeholder="Email*" value="'+t+'"/><input style="margin-top:4px;width:100%;padding:4px;padding-left:15px" name="telefono" placeholder="Telefono" /><textarea name="comentario" rows="3" data-min-rows="3" class="autoExpand" style="width:100%;padding-left:15px;padding-top:5px;margin-top:4px" placeholder="Ingresa el motivo de la calificación..." autocomplete="off"></textarea><button id="calificacionSend2" class="calificacionBtn2"><i style="margin-right: 5px; float: left; margin-left: 5px;"></i><label style="text-align: center;">ENVIAR</label></button><div class="flex-container"><a class="btn-no-gracias" id="cerrar-chat-button" tabindex="0"><strong>No gracias</strong></a></div></div></div></div></div>'),$(".rating2").on("click",function(){"none"==$("#divAdicionalRating2").css("display")&&($("#cerrar-chat-button").remove(),$(".linea").remove(),$("#divAdicionalRating2").show(),$(".calificar-cerrar").css("padding-top","60px"),$(".chat-widget-message-log").scrollTop($(".chat-widget-message-log").prop("scrollHeight")))}),$(".calificacionBtn2").on("click",function(){self.calificarCerrar()})},_submitMessage:function(){var e=this.getInput();""==e||(this.sendMessage(e),this.clearInput())},_shouldScroll:function(){return this._messageLog.scrollTop()+this._messageLog.prop("clientHeight")===this._messageLog.prop("scrollHeight")},_scrollToBottom:function(){this._messageLog.scrollTop(this._messageLog.prop("scrollHeight"))},getInput:function(){return this._messageInput.val().replace(/\r?\n/gi,"")},clearInput:function(){this._messageInput.val("")},sendMessage:function(e,t){e=this.quitaacentos(e),console.log("enviando mensaje:"+e);var i={type:"message",message:e,session:this.options.idChatActual};this._guardarEnBase("envio","message="+e);var s="";void 0!==t&&"opcion"==t&&(s=" sendOpcion"),this._messageLog.append('<span class="chat-widget-message-container-received"><p class="chat-widget-message sent'+s+'">'+e+"</p></span>"),this._messageLog.append('<span class="chat-widget-message-container-received"><p class="timesent">'+this.getCurrentTime()+"</p></span>"),this._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),this._guardarEnBase("historial",'message=<span class="chat-widget-message-container-received"><p class="chat-widget-message sent'+s+'">'+e+'</p></span><span class="chat-widget-message-container-received"><p class="timesent">'+this.getCurrentTime()+"</p></span>"),this._socket.send(JSON.stringify(i)),this._shouldScroll()||this._scrollToBottom()},receiveMessage:function(e){var t=0;if(-1!=e.indexOf("--start--")){var i="";"undefined"!=typeof dataLayer&&void 0!==dataLayer[3]&&void 0!==dataLayer[3].visitorContactInfo&&void 0!==dataLayer[3].visitorContactInfo[1]&&""!=dataLayer[3].visitorContactInfo[1]&&(i=dataLayer[3].visitorContactInfo[1]),e=e.replace("Hola","Hola "+i),$("#escribiendo").remove(),e=e.replace("--start--","");var s='<div class="chat-widget-message received">                        Te puedo ayudar con estos temas                        <ul>                            <li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/carrito.svg" /> Comprar un producto</a></li>                            <li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/envios.svg" /> Status de un pedido</a></li>\t\t\t\t\t\t\t<li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/promociones.svg" /> Promociones</a></li>\t\t\t\t\t\t\t<li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/nuestrastiendas.svg" /> Información de Tiendas</a></li>\t\t\t\t\t\t\t<li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/pregfrecuentes.svg" /> Preguntas Frecuentes</a></li>\t\t\t\t\t\t</ul>                    </div>';this._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">'+e+"</div></div>"),this._messageLog.append(s),this._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">O dime en que te puedo ayudar</div></div>'),this._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived">'+this.getCurrentTime()+"</p></div>");var c=this;$(".btn-verde").on("click",function(){"undefined"!=typeof dataLayer&&dataLayer.push({event:"chatbotAction",accion:"botones",categoria:"chatbot",etiqueta:this.innerHTML.replace(/<(?:.|\n)*?>/gm,"")}),c.enviarOpcion(this)}),this.options.idcarrusel_opciones++,this._shouldScroll()||this._scrollToBottom()}else if(-1!=e.indexOf("--informacion_de_tiendas--"))$("#escribiendo").remove(),e=e.replace("--informacion_de_tiendas--",""),s='<div class="chat-widget-message received">                        Te puedo ayudar con estos temas                        <ul>                            <li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/horarios.svg" /> Horarios</a></li>                            <li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/ubicacion1.svg" /> Direcciones</a></li>\t\t\t\t\t\t\t<li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/telefonos.svg" /> Telefonos</a></li>                        </ul>                    </div>',this._messageLog.append(s),c=this,$(".btn-verde").on("click",function(){"undefined"!=typeof dataLayer&&dataLayer.push({event:"chatbotAction",accion:"botones",categoria:"chatbot",etiqueta:this.innerHTML.replace(/<(?:.|\n)*?>/gm,"")}),c.enviarOpcion(this)}),this.options.idcarrusel_opciones++,this._shouldScroll()||this._scrollToBottom();else if(-1!=e.indexOf("--preguntas_generales--"))$("#escribiendo").remove(),e=e.replace("--preguntas_generales--",""),this._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">'+e+"</div></div>"),this._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived">'+this.getCurrentTime()+"</p></div>"),s='<div class="chat-widget-message received">                        Te puedo ayudar con estos temas                        <ul>                            <li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/terminosycondiciones.svg" /> Terminos y Condiciones</a></li>                            <li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/ubicacion1.svg" /> Contactanos</a></li>\t\t\t\t\t\t\t<li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/retractodecompra.svg" /> Retracto de Compra</a></li>\t\t\t\t\t\t\t<li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/garantias.svg" /> Garantías</a></li>\t\t\t\t\t\t\t<li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/condenvio.svg" /> Condiciones de Envío</a></li>                        </ul>                    </div>',this._messageLog.append(s),c=this,$(".btn-verde").on("click",function(){"undefined"!=typeof dataLayer&&dataLayer.push({event:"chatbotAction",accion:"botones",categoria:"chatbot",etiqueta:this.innerHTML.replace(/<(?:.|\n)*?>/gm,"")}),c.enviarOpcion(this)}),this.options.idcarrusel_opciones++,this._shouldScroll()||this._scrollToBottom();else if("--transferir--"==e)$("#escribiendo").remove(),this._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">Lo siento, aún no se como ayudarlo con este tema, me encuentro en proceso de capacitación. Si deseas que te transfiera con un ejecutivo haz clic en el siguiente botón <a style="margin-top:5px;" href="#" class="goToChat">Hablar con Ejecutivo Jumbo</a></div></div>'),this._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived">'+this.getCurrentTime()+"</p></div>"),this._guardarEnBase("envio",'message=Lo siento, aún no se como ayudarlo con este tema, me encuentro en proceso de capacitación. Si deseas que te transfiera con un ejecutivo haz clic en el siguiente botón <a style="margin-top:5px;" href="#">Hablar con Ejecutivo Jumbo</a>'),this._guardarEnBase("historial",'message=<div class="chat-widget-message-container"><div class="chat-widget-message received">Lo siento, aún no se como ayudarlo con este tema, me encuentro en proceso de capacitación. Si deseas que te transfiera con un ejecutivo haz clic en el siguiente botón <a style="margin-top:5px;" href="#" class="goToChat">Hablar con Ejecutivo Jumbo</a></div></div><div class="chat-widget-message-container"><p class="timerecived">'+this.getCurrentTime()+"</p></div>"),this._shouldScroll()||this._scrollToBottom(),c=this,$(".goToChat").on("click",function(){c.formularioTransferir()}),this.options.idmensaje++;else if("--transferir_btn--"==e)$("#escribiendo").remove(),this.formularioTransferir(),this.options.idmensaje++;else if(-1!=e.indexOf("--consultoOrdenEmail--"))e=e.replace("--consultoOrdenEmail--",""),this._consultaOrdenes(e);else if("--ofertas--"==e)this._consultaOfertas("recomendacion");else if("--ofertas_clic--"==e)this._consultaOfertas("clic_boton_ofertas");else if(-1!=e.indexOf("--consultoOrdenId--"))e=e.replace("--consultoOrdenId--",""),this._consultaOrden(e);else if(-1!=e.indexOf("--test--"))e=e.replace("--test--",""),this._consultaProducto(e);else if(-1!=e.indexOf("--testpromo--"))e=e.replace("--testpromo--",""),this._consultaPromocion(e);else if(-1!=e.indexOf("--testborracookie--"))e=e.replace("--testborracookie--",""),this.eliminarcookie();else if(-1!=e.indexOf("--testpuntos--"))e=e.replace("--testpuntos--",""),this._consultaPuntos(e);else if(-1!=e.indexOf("--rating--")&&(e=e.replace("--rating--",""),t=1),""!=e&&(this._guardarEnBase("recibo","message="+e),this._guardarEnBase("historial",'message=<div class="chat-widget-message-container"><p class="chat-widget-message received">'+e.replace('"','"')+'</p></div><div class="chat-widget-message-container"><p class="timerecived">'+this.getCurrentTime()+"</p></div>"),$("#escribiendo").remove(),this._messageLog.append('<div class="chat-widget-message-container"><p class="chat-widget-message received">'+e+"</p></div>"),this._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived">'+this.getCurrentTime()+"</p></div>"),this._shouldScroll()||this._scrollToBottom()),1==t){$("#escribiendo").remove(),i="";var o="";"undefined"!=typeof dataLayer&&void 0!==dataLayer[3]&&void 0!==dataLayer[3].visitorContactInfo&&(void 0!==dataLayer[3].visitorContactInfo[1]&&""!=dataLayer[3].visitorContactInfo[1]&&(i=dataLayer[3].visitorContactInfo[1]),void 0!==dataLayer[3].visitorContactInfo[2]&&""!=dataLayer[3].visitorContactInfo[2]&&(i+=" "+dataLayer[3].visitorContactInfo[2]),void 0!==dataLayer[3].visitorContactInfo[0]&&""!=dataLayer[3].visitorContactInfo[0]&&(o=dataLayer[3].visitorContactInfo[0])),this._messageLog.append('<div style="" class="chat-widget-message-container"><div class="chat-widget-message received"><fieldset style="margin-bottom: 10px; text-align:center;" class="rating"><legend>Quisieras colaborar con mi entrenamiento? Como calificarías mi atención?</legend><leyend id="noCalifico" style="color:red;clear:both;width:100%;float:left;display:none;">Favor selecciona tu calificación</leyend><span class="rating"><input type="radio" id="star5" name="rating" value="5" /><label for="star5" title="Genial!">5 Estrellas</label><input type="radio" id="star4" name="rating" value="4" /><label for="star4" title="Muy buena">4 Estrellas</label>    <input type="radio" id="star3" name="rating" value="3" /><label for="star3" title="Buena">3 Estrellas</label>    <input type="radio" id="star2" name="rating" value="2" /><label for="star2" title="Algo ayudo">2 Estrellas</label>    <input type="radio" id="star1" name="rating" value="1" /><label for="star1" title="Perdida de tiempo">1 Estrella</label></span></fieldset><div id="divAdicionalRating" style="display:none"><input style="width:100%;padding:4px;margin-top:4px;padding-left:15px" name="nombre" placeholder="Nombre*" value="'+i+'"/><input style="width:100%;padding:4px;margin-top:4px;padding-left:15px" name="email" placeholder="Email*" value="'+o+'"/><input style="margin-top:4px;width:100%;padding:4px;padding-left:15px" name="telefono" placeholder="Telefono" /><textarea name="comentario" rows="3" data-min-rows="3" class="autoExpand" style="width:100%;padding-left:15px;padding-top:5px;margin-top:4px" placeholder="Ingresa el motivo de la calificación..." autocomplete="off"></textarea><button id="calificacionSend" class="calificacionBtn"><i style="margin-right: 5px; float: left; margin-left: 5px;"></i><label style="text-align: center;">ENVIAR</label></button></div></div></div>'),this._shouldScroll()||this._scrollToBottom(),c=this,$(".rating").on("click",function(){"none"==$("#divAdicionalRating").css("display")&&($("#divAdicionalRating").show(),$(".chat-widget-message-log").scrollTop($(".chat-widget-message-log").prop("scrollHeight")))}),$(".calificacionBtn").on("click",function(){c.calificar()})}},getCurrentTime:function(){return(new Date).toLocaleTimeString().replace(/([\d]+:[\d]{2})(:[\d]{2})(.*)/,"$1$3")},eliminarcookie:function(){for(var e=document.cookie.split("; "),t=0;t<e.length;t++)for(var i=window.location.hostname.split(".");i.length>0;){var s=encodeURIComponent(e[t].split(";")[0].split("=")[0])+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; domain="+i.join(".")+" ;path=",c=location.pathname.split("/");for(document.cookie=s+"/";c.length>0;)document.cookie=s+c.join("/"),c.pop();i.shift()}location.reload()},_guardarEnBase:function(e,t){var i=this;window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status&&""!=this.responseText){var e=JSON.parse(this.responseText);void 0!==e.id&&(i.options.idChatActual=e.id,console.log(e),console.log("respuesta--id:"+i.options.idChatActual),void 0!==e.chat?(i._messageLog.html(e.chat),$(".carruselOpciones").slick({nextArrow:'<i class="slick-next fa-chevron-right"></i>',prevArrow:'<i class="slick-prev fa-chevron-left"></i>'}),$("#escribiendo").remove(),i._scrollToBottom()):i._socket.readyState==i._socket.OPEN?i._socket.send(JSON.stringify({type:"message",message:"hola",session:i.options.idChatActual})):function e(){console.log(i._socket.readyState),i._socket.readyState==i._socket.OPEN?i._socket.send(JSON.stringify({type:"message",message:"hola",session:i.options.idChatActual})):setTimeout(e,1500)}())}};var s=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action="+e;s+="&idchat="+this.options.idChatActual,"historial"!=e&&null!=t&&(s+="&"+t),xmlhttp.open("POST",s,!0),xmlhttp.withCredentials=!0,xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),"historial"==e?xmlhttp.send(t):xmlhttp.send()},_consultaOrdenes:function(e){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");var t=this;xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);console.log(e);var i="";if($("#escribiendo").remove(),Object.keys(e.list).length>0){i="Encuentro las siguientes ordenes, haz clic en el numero de orden para brindarte mas información:<br>",i+='<table class="tblOrden">',i+='<tr style="padding:4px;font-weight:bold;background:rgba(241,23,20,1);color:#fff;"><td style="width:42%">Num</td><td style="width:30%">Fecha</td></tr>';for(var s=0;s<Object.keys(e.list).length;s++)i+='<tr class="ver_pedido" style="cursor:pointer;" idorden="'+e.list[s].orderId+'"><td>'+e.list[s].orderId+"</td>",i+="<td>"+t._formatDate(e.list[s].creationDate)+"</td>";i+="</table>"}else i="Lo siento, no encuentro ordenes recientes para su mail, por favor verifique que sea el mail correcto y este bien escrito. O digame su numero de pedido";t._guardarEnBase("envio","message="+i),t._guardarEnBase("historial",'message=<div class="chat-widget-message-container"><div class="chat-widget-message received">'+i+'</div></div><div class="chat-widget-message-container"><p class="timerecived">'+t.getCurrentTime()+"</p></div>"),t._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">'+i+"</div></div>"),t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived">'+t.getCurrentTime()+"</p></div>"),$(".ver_pedido").on("click",function(){console.log($(this).attr("idorden")),t._consultaOrden($(this).attr("idorden"))}),t._shouldScroll()||t._scrollToBottom()}};var i=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=consultarOrdenes&email="+e;xmlhttp.open("GET",i,!0),xmlhttp.withCredentials=!0,xmlhttp.send()},_consultaOrden:function(e){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");var t=this;xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);console.log(e),$("#escribiendo").remove(),t._guardarEnBase("envio","message="),t._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">'+e.respuesta+"</div></div>"),t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),t._shouldScroll()||t._scrollToBottom()}};var i=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=consultarOrden&ordenid="+e;xmlhttp.open("GET",i,!0),xmlhttp.withCredentials=!0,xmlhttp.send()},_consultaOfertas:function(e){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");var t=this;xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){for(var i=JSON.parse(this.responseText),s="",c='<div class="chat_producto_slider'+t.options.idcarrusel+' chat_producto_slider responsive" style="text-align:center">',o=[],a=0;a<Object.keys(i).length;a++){s+=i[a].productName.toLowerCase()+"<br>";var r=[];if(r.nombre=t.quitaacentos(i[a].productName.toLowerCase()),r.id=i[a].productId,r.precio=i[a].items[0].sellers[0].commertialOffer.Price,r.addtocartlink=i[a].items[0].sellers[0].addToCartLink,c+="<div>",c+="<a style='width:97%;' href='"+i[a].link+"'><img style='margin:auto;height:130px' src='"+i[a].items[0].images[0].imageUrl+"' /></a>",c+="<div class='info-description'>",c+="<h3 class='chatProductName'>"+r.nombre+" </h3>",console.log(i),i[a].items[0].sellers[0].commertialOffer.AvailableQuantity>0){i[a].items[0].sellers[0].commertialOffer.Price,i[a].items[0].sellers[0].commertialOffer.ListPrice;var n=i[a].items[0].sellers[0].commertialOffer.ListPrice,d=i[a].items[0].sellers[0].commertialOffer.Price;d<n&&(c+="<span class='txt-gris'>Precio Regular $"+n.toLocaleString()+"</span>"),c+="<span class='txt-verde'>Precio Ahora $<strong>"+d.toLocaleString()+"</strong></span>";for(var p=[],l=0;l<Object.keys(i[a].items[0].sellers[0].commertialOffer.Teasers).length;l++)if(console.log(Object.keys(i[a].items[0].sellers[0].commertialOffer.Teasers).length),!(Object.keys(i[a].items[0].sellers[0].commertialOffer.Teasers).length<=0)&&(console.log(i[a].items[0].sellers[0].commertialOffer.Teasers),i[a].items[0].sellers[0].commertialOffer.Teasers[l]["<Effects>k__BackingField"]["<Parameters>k__BackingField"][0].includes("<Value>k__BackingField"))){var u=i[a].items[0].sellers[0].commertialOffer.Teasers[l]["<Name>k__BackingField"].split("-"),m=i[a].items[0].sellers[0].commertialOffer.Teasers[l]["<Effects>k__BackingField"]["<Parameters>k__BackingField"][0]["<Value>k__BackingField"],v=Math.round(i[a].items[0].sellers[0].commertialOffer.PriceWithoutDiscount-i[a].items[0].sellers[0].commertialOffer.PriceWithoutDiscount*(m/100));switch(v=v.toLocaleString(),u[0]){case"PCENCO":if(null==p.PCENCO){p.PCENCO=[],p.PCENCO.descuento=v,p.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+v+"</span></div>";break}if(null==p.PCENCO.descuento){p.PCENCO.descuento=v,p.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+v+"</span></div>";break}if(p.PCENCO.descuento<v){p.PCENCO.descuento=v,p.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+v+"</span></div>";break}case"VISA":if(null==p.VISA){p.VISA=[],p.VISA.descuento=v,p.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+v+"</span></div>";break}if(null==p.VISA.descuento){p.VISA.descuento=v,p.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+v+"</span></div>";break}if(p.VISA.descuento<v){p.VISA.descuento=v,p.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+v+"</span></div>";break}case"AMEX":if(null==p.AMEX){p.AMEX=[],p.AMEX.descuento=v,p.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+v+"</span></div>";break}if(null==p.AMEX.descuento){p.AMEX.descuento=v,p.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+v+"</span></div>";break}if(p.AMEX.descuento<v){p.AMEX.descuento=v,p.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+v+"</span></div>";break}case"COLP":if(null==p.COLP){p.COLP=[],p.COLP.descuento=v,p.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+v+"</span></div>";break}if(null==p.COLP.descuento){p.COLP.descuento=v,p.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+v+"</span></div>";break}if(p.COLP.descuento<v){p.COLP.descuento=v,p.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+v+"</span></div>";break}case"BBVA":if(null==p.BBVA){p.BBVA=[],p.BBVA.descuento=v,p.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+v+"</span></div>";break}if(null==p.BBVA.descuento){p.BBVA.descuento=v,p.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+v+"</span></div>";break}if(p.BBVA.descuento<v){p.BBVA.descuento=v,p.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+v+"</span></div>";break}case"AVAL":if(null==p.AVAL){p.AVAL=[],p.AVAL.descuento=v,p.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+v+"</span></div>";break}if(null==p.AVAL.descuento){p.AVAL.descuento=v,p.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+v+"</span></div>";break}if(p.AVAL.descuento<v){p.AVAL.descuento=v,p.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+v+"</span></div>";break}case"TCENCO24":if(null==p.TCENCO24){p.TCENCO24=[],p.TCENCO24.descuento=v,p.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(null==p.TCENCO24.descuento){p.TCENCO24.descuento=v,p.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(p.TCENCO24.descuento<v){p.TCENCO24.descuento=v,p.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}case"COD":if(null==p.COD){p.COD=[],p.COD.descuento=v,p.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+v+"</span></div>";break}if(null==p.COD.descuento){p.COD.descuento=v,p.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+v+"</span></div>";break}if(p.COD.descuento<v){p.COD.descuento=v,p.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+v+"</span></div>";break}case"TCENCO":if(null==p.TCENCO){p.TCENCO=[],p.TCENCO.descuento=v,p.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(null==p.TCENCO.descuento){p.TCENCO.descuento=v,p.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(p.TCENCO.descuento<v){p.TCENCO.descuento=v,p.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}case"BBOG":if(null==p.BBOG){p.BBOG=[],p.BBOG.descuento=v,p.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+v+"</span></div>";break}if(null==p.BBOG.descuento){p.BBOG.descuento=v,p.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+v+"</span></div>";break}if(p.BBOG.descuento<v){p.BBOG.descuento=v,p.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+v+"</span></div>";break}case"ITAU":if(null==p.ITAU){p.ITAU=[],p.ITAU.descuento=v,p.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+v+"</span></div>";break}if(null==p.ITAU.descuento){p.ITAU.descuento=v,p.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+v+"</span></div>";break}if(p.ITAU.descuento<v){p.ITAU.descuento=v,p.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+v+"</span></div>";break}case"MCARD":if(null==p.MCARD){p.MCARD=[],p.MCARD.descuento=v,p.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+v+"</span></div>";break}if(null==p.MCARD.descuento){p.MCARD.descuento=v,p.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+v+"</span></div>";break}if(p.MCARD.descuento<v){p.MCARD.descuento=v,p.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+v+"</span></div>";break}case"CVAL":null!=p.CVAL?null==p.CVAL.descuento?(p.CVAL.descuento=v,p.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+v+"</span></div>"):p.CVAL.descuento<v&&(p.CVAL.descuento=v,p.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+v+"</span></div>"):(p.CVAL=[],p.CVAL.descuento=v,p.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+v+"</span></div>")}}for(var _ in console.log(p),p)null!=p[_].contenido&&(c+=p[_].contenido);c+="<a class='btn btn-naranja chat_addtocart ' prod_nombre='"+r.nombre+"' prod_id='"+r.id+"' prod_precio='"+r.precio+"' prod_addtocartlink='"+r.addtocartlink+"' href='#'><i class='fa fa-shopping-cart' aria-hidden='true'></i><strong>&nbsp; Comprar</strong></a>",c+="<span class='line'></span>",c+="<div  class='flex-container'>",c+="<a href='"+i[a].link+"'class='btn btn-gris flex'><i class='fa fa-search-plus' aria-hidden='true'></i> <strong>  Ver Producto</strong></a>"}else c+='<div class="product-item__price product-item__no-stock prices-formatted"><div class="font-icn alert"></div><div class="text">Sin Stock</div></div>',c+="<div class='precio_oferta' style='color:#e8e6e4;'>-</div>",c+="<a href='"+i[a].link+"'class='btn btn-gris flex' style='margin: 4px auto !important;'><i class='fa fa-search-plus' aria-hidden='true'></i> <strong>  Ver Producto</strong></a>";c+="</div>",c+="</div>",c+="</div>",o.push({name:r.nombre,id:r.id,price:r.precio,brand:"",category:"",variant:"",list:"Chatbot Vista Productos",position:a})}c+="</div>",Object.keys(o).length>0?(t._guardarEnBase("recibo","message="+s),"undefined"!=typeof dataLayer&&dataLayer.push({event:"OfertasChatbot",origen:e,ecommerce:{currencyCode:"SOL",impressions:o}}),$("#escribiendo").remove(),t._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">'+c+"</div></div>"),t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>')):($("#escribiendo").remove(),t._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received"> Lo siento,este producto no se encuentra registrado.</div></div>'),t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>')),t._shouldScroll()||t._scrollToBottom(),$(".chat_producto_slider"+t.options.idcarrusel).slick({nextArrow:'<i class="slick-next fa-chevron-right"></i>',prevArrow:'<i class="slick-prev fa-chevron-left"></i>'}),t.options.idcarrusel++,$(".chat_addtocart").on("click",function(){var e=this.getAttribute("prod_nombre"),i=this.getAttribute("prod_id"),s=this.getAttribute("prod_precio"),c=this.getAttribute("prod_addtocartlink");t.agregarCarro(e,i,s,c)})}},$("#escribiendo").remove(),this._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">Voy a recomendarle algunas de nuestras mejores ofertas.</div></div>'),this._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),this._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),this._shouldScroll()||this._scrollToBottom(),xmlhttp.open("GET"," https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=ofertas",!0),xmlhttp.withCredentials=!0,xmlhttp.send()},_consultaProducto:function(e,t){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");var i=this;xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText).productos,s="";console.log(t);for(var c='<div class="chat_producto_slider'+i.options.idcarrusel+' chat_producto_slider responsive" style="text-align:center">',o=[],a=0;a<Object.keys(t).length;a++){s+=t[a].nombre.toLowerCase()+"<br>";var r=[];if(r.nombre=i.quitaacentos(t[a].nombre.toLowerCase()),r.id=t[a].id,r.precio=t[a].precio,r.peciound=t[a].peciound,r.addtocartlink=t[a].agregaralcarro,c+="<div>",c+="<a style='width:97%;' href='"+t[a].link+"'><img style='margin:auto;margin:auto;height:130px' src='"+t[a].imagen+"' /></a>",c+="<div class='info-description'>",c+="<h3 class='chatProductName'>"+r.nombre+" </h3>",t[a].AvailableQuantity>0){t[a].listprecio;var n=t[a].listprecio,d=t[a].precio,p=t[a].peciound;d<n&&(c+="<span class='txt-gris'>Precio Regular $"+n.toLocaleString()+"</span>"),c+="<span class='txt-verde'>Precio Ahora $<strong>"+d.toLocaleString()+"</strong></span>",c+="<span class='txt-verde-precunidad'>"+p+"</span>";for(var l=[],u=0;u<Object.keys(t[a].sellers[0].commertialOffer.Teasers).length;u++)if(!(Object.keys(t[a].sellers[0].commertialOffer.Teasers).length<=0)){console.log(Object.keys(t[a].sellers[0].commertialOffer.Teasers).length);var m=t[a].sellers[0].commertialOffer.Teasers[u]["<Name>k__BackingField"].split("-"),v=t[a].sellers[0].commertialOffer.Teasers[u]["<Effects>k__BackingField"]["<Parameters>k__BackingField"][0]["<Value>k__BackingField"],_=Math.round(t[a].sellers[0].commertialOffer.PriceWithoutDiscount-t[a].sellers[0].commertialOffer.PriceWithoutDiscount*(v/100));switch(_=_.toLocaleString(),m[0]){case"PCENCO":if(null==l.PCENCO){l.PCENCO=[],l.PCENCO.descuento=_,l.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+_+"</span></div>";break}if(null==l.PCENCO.descuento){l.PCENCO.descuento=_,l.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+_+"</span></div>";break}if(l.PCENCO.descuento<_){l.PCENCO.descuento=_,l.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+_+"</span></div>";break}case"VISA":if(null==l.VISA){l.VISA=[],l.VISA.descuento=_,l.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+_+"</span></div>";break}if(null==l.VISA.descuento){l.VISA.descuento=_,l.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+_+"</span></div>";break}if(l.VISA.descuento<_){l.VISA.descuento=_,l.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+_+"</span></div>";break}case"AMEX":if(null==l.AMEX){l.AMEX=[],l.AMEX.descuento=_,l.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+_+"</span></div>";break}if(null==l.AMEX.descuento){l.AMEX.descuento=_,l.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+_+"</span></div>";break}if(l.AMEX.descuento<_){l.AMEX.descuento=_,l.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+_+"</span></div>";break}case"COLP":if(null==l.COLP){l.COLP=[],l.COLP.descuento=_,l.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+_+"</span></div>";break}if(null==l.COLP.descuento){l.COLP.descuento=_,l.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+_+"</span></div>";break}if(l.COLP.descuento<_){l.COLP.descuento=_,l.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+_+"</span></div>";break}case"BBVA":if(null==l.BBVA){l.BBVA=[],l.BBVA.descuento=_,l.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+_+"</span></div>";break}if(null==l.BBVA.descuento){l.BBVA.descuento=_,l.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+_+"</span></div>";break}if(l.BBVA.descuento<_){l.BBVA.descuento=_,l.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+_+"</span></div>";break}case"AVAL":if(null==l.AVAL){l.AVAL=[],l.AVAL.descuento=_,l.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+_+"</span></div>";break}if(null==l.AVAL.descuento){l.AVAL.descuento=_,l.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+_+"</span></div>";break}if(l.AVAL.descuento<_){l.AVAL.descuento=_,l.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+_+"</span></div>";break}case"TCENCO24":if(null==l.TCENCO24){l.TCENCO24=[],l.TCENCO24.descuento=_,l.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+_+"</span></div>";break}if(null==l.TCENCO24.descuento){l.TCENCO24.descuento=_,l.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+_+"</span></div>";break}if(l.TCENCO24.descuento<_){l.TCENCO24.descuento=_,l.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+_+"</span></div>";break}case"COD":if(null==l.COD){l.COD=[],l.COD.descuento=_,l.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+_+"</span></div>";break}if(null==l.COD.descuento){l.COD.descuento=_,l.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+_+"</span></div>";break}if(l.COD.descuento<_){l.COD.descuento=_,l.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+_+"</span></div>";break}case"TCENCO":if(null==l.TCENCO){l.TCENCO=[],l.TCENCO.descuento=_,l.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+_+"</span></div>";break}if(null==l.TCENCO.descuento){l.TCENCO.descuento=_,l.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+_+"</span></div>";break}if(l.TCENCO.descuento<_){l.TCENCO.descuento=_,l.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+_+"</span></div>";break}case"BBOG":if(null==l.BBOG){l.BBOG=[],l.BBOG.descuento=_,l.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+_+"</span></div>";break}if(null==l.BBOG.descuento){l.BBOG.descuento=_,l.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+_+"</span></div>";break}if(l.BBOG.descuento<_){l.BBOG.descuento=_,l.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+_+"</span></div>";break}case"ITAU":if(null==l.ITAU){l.ITAU=[],l.ITAU.descuento=_,l.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+_+"</span></div>";break}if(null==l.ITAU.descuento){l.ITAU.descuento=_,l.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+_+"</span></div>";break}if(l.ITAU.descuento<_){l.ITAU.descuento=_,l.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+_+"</span></div>";break}case"MCARD":if(null==l.MCARD){l.MCARD=[],l.MCARD.descuento=_,l.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+_+"</span></div>";break}if(null==l.MCARD.descuento){l.MCARD.descuento=_,l.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+_+"</span></div>";break}if(l.MCARD.descuento<_){l.MCARD.descuento=_,l.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+_+"</span></div>";break}case"CVAL":null!=l.CVAL?null==l.CVAL.descuento?(l.CVAL.descuento=_,l.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+_+"</span></div>"):l.CVAL.descuento<_&&(l.CVAL.descuento=_,l.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+_+"</span></div>"):(l.CVAL=[],l.CVAL.descuento=_,l.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+_+"</span></div>")}}for(var g in l)null!=l[g].contenido&&(c+=l[g].contenido);c+="<a class='btn btn-naranja chat_addtocart ' prod_nombre='"+r.nombre+"' prod_id='"+r.id+"' prod_precio='"+r.precio+"' prod_addtocartlink='"+r.addtocartlink+"' href='#'><i class='fa fa-shopping-cart' aria-hidden='true'></i><strong>&nbsp; Comprar</strong></a>",c+="<span class='line'></span>",c+="<div  class='flex-container'>",c+="<a href='"+t[a].link+"'class='btn btn-gris flex'><i class='fa fa-search-plus' aria-hidden='true'></i> <strong>  Ver Producto</strong></a>",c+="<a href='https://www.jumbo.com.ar/busca/?ft="+e+"' class='btn btn-gris'><i class='fa fa-shopping-basket' aria-hidden='true'></i> <strong>  Relacionados</strong></a>",c+="</div>"}else c+='<div class="product-item__price product-item__no-stock prices-formatted"><div class="font-icn alert"></div><div class="text">Sin Stock</div></div>',c+="<div class='precio_oferta' style='color:#e8e6e4;'>-</div>",c+="<span class='line'></span>",c+="<div class='flex-container'>",c+="<a href='"+t[a].link+"'class='btn btn-gris flex'><i class='fa fa-search-plus' aria-hidden='true'></i> <strong>  Ver Producto</strong></a>",c+="<a href='https://www.jumbo.com.ar/busca/?ft="+e+"' class='btn btn-gris'><i class='fa fa-shopping-basket' aria-hidden='true'></i> <strong>  Relacionados</strong></a>",c+="</div>";c+="</div>",c+="</div>",o.push({name:r.nombre,id:r.id,price:r.precio,brand:"",category:"",variant:"",list:"Chatbot Vista Productos",position:a})}c+="</div>",Object.keys(o).length>0?(i._guardarEnBase("recibo","message="+s),"undefined"!=typeof dataLayer&&dataLayer.push({event:"ConsultaProductoChatbot",consulta:e,ecommerce:{currencyCode:"PEN",impressions:o}}),$("#escribiendo").remove(),i._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">'+c+"</div></div>"),i._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>')):($("#escribiendo").remove(),i._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received"> Lo siento,este producto no se encuentra registrado.</div></div>'),i._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>')),i._shouldScroll()||i._scrollToBottom(),$(".chat_producto_slider"+i.options.idcarrusel).slick({nextArrow:'<i class="slick-next fa-chevron-right" style="right:-18px;"></i>',prevArrow:'<i class="slick-prev fa-chevron-left"></i>'}),i.options.idcarrusel++,$(".chat_addtocart").on("click",function(){var e=this.getAttribute("prod_nombre"),t=this.getAttribute("prod_id"),s=this.getAttribute("prod_precio"),c=this.getAttribute("prod_addtocartlink");i.agregarCarro(e,t,s,c)})}},$("#escribiendo").remove(),this._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">Por favor aguarde un momento mientras consulto el precio y stock del producto o algunos similares.</div></div>'),this._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),this._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),this._shouldScroll()||this._scrollToBottom(),"%20Dulce Pasion"==e&&(e="torta&fq=B:2211");var s=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=consultarProducto&producto="+e;xmlhttp.open("GET",s,!0),xmlhttp.withCredentials=!0,xmlhttp.send()},_consultaPuntos:function(){$("#escribiendo").remove();var e=this;if($(".chat-widget-message-log").append('<div class="chat-widget-message-container"><div style="background-color:#f5f4f4;" class="chat-widget-message received" id="cupones">Indicar Tipo de Documento para consulta:<p style="padding-bottom:5px;"></p><div style="background-color:#f5f4f4;"></div>Documento<input class="dni" style="padding:3px 2px 3px 2px;margin:4px 0 8px 0;width:100%" type="text" name="txtDni" indexDni="'+e.options.idFormPuntos+'" id="dnipuntos'+e.options.idFormPuntos+'"><button indexPuntos="'+e.options.idFormPuntos+'" style="margin-top:20px;border: 1px solid #FF0000;border-radius: 5px;" id="goToPuntos'+e.options.idFormPuntos+'"class="goToChat botonconsultar"><i style="margin-right: 5px; float: left; margin-left: 5px;"></i><label style="text-align: center;">Consultar</label></button></div></div>'),"undefined"!=typeof dataLayer&&void 0!==dataLayer[3]&&void 0!==dataLayer[3].visitorContactInfo&&(void 0!==dataLayer[3].visitorContactInfo[1]&&""!=dataLayer[3].visitorContactInfo[1]&&(nombrecli=dataLayer[3].visitorContactInfo[1]),void 0!==dataLayer[3].visitorContactInfo[2]&&""!=dataLayer[3].visitorContactInfo[2]&&(nombrecli+=" "+dataLayer[3].visitorContactInfo[2]),void 0!==dataLayer[3].visitorContactInfo[0]&&""!=dataLayer[3].visitorContactInfo[0])){emailcli=dataLayer[3].visitorContactInfo[0];e=this;window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText);console.log(t),e.options.dnicliPuntos=t[0].document,$("#dnipuntos"+e.options.idFormPuntos).val(e.options.dnicliPuntos)}};var t="  https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=datosUsuario&email="+emailcli;xmlhttp.open("GET",t,!1),xmlhttp.withCredentials=!0,xmlhttp.send()}(e=this)._shouldScroll()||e._scrollToBottom();var i=e.options.idFormPuntos;console.log(i),$(this).attr("indexPuntos"),$("#dnipuntos"+e.options.idFormPuntos).on("keydown",function(t){13==t.which&&($("#goToPuntos"+i).click(),console.log(e.options.idFormPuntos),console.log(i))}),$("#goToPuntos"+e.options.idFormPuntos).unbind("click"),$("#goToPuntos"+e.options.idFormPuntos).on("click",function(){var t=$(this).attr("indexPuntos");if(e._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),e._shouldScroll()||e._scrollToBottom(),$("#goToPuntos"+t).removeClass("goToChat"),""==$("#dnipuntos"+t).val())return $("#escribiendo").remove(),document.getElementById("dnipuntos"+t).style.background="red",void document.getElementById("dnipuntos"+t).setAttribute("onkeyup","this.style.background = 'white'");if($("#goToPuntos"+t).unbind("click"),$("#goToPuntos"+t).attr("disabled","disabled"),$("#dnipuntos"+t).attr("disabled","disabled"),$("#filtro"+t).attr("disabled","disabled"),""==e.options.dnicliPuntos){var i=$("#dnipuntos"+t).val();e._puntosId(i),console.log(i)}else i=$("#dnipuntos"+t).val(),e._puntosId(i),console.log(i)}),e.options.idFormPuntos++},_puntosId:function(e){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");var t=this;xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var i=JSON.parse(this.responseText);if(console.log(i),null!=i.error)return $("#escribiendo").remove(),t._messageLog.append('<div class="chat-widget-message-container" style="margin-top: 3px;"><div class="chat-widget-message received " >'+i.error+"</div></div>"),void t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>');if("404"==i.internalCode)t._shouldScroll()||t._scrollToBottom(),$("#escribiendo").remove(),t._messageLog.append('<div class="chat-widget-message-container" style="margin-top: 3px;"><div class="chat-widget-message received " >No hay puntos bonus asociados al N° de Documento: <b>'+e+'</b> asegurese de que sea correcto<button style="margin-top:20px;border: 1px solid #FF0000;border-radius: 5px;" indexCorregirPuntos="'+t.options.idItentar+'"id="corregirpuntos'+t.options.idItentar+'"class="goToChat botonconsultar"><i style="margin-right: 5px; float: left; margin-left: 5px;"></i><label style="text-align: center;">Intentar nuevamente</label></button></div></div>'),t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),t._shouldScroll()||t._scrollToBottom(),console.log("boton"),$("#corregirpuntos"+t.options.idItentar).unbind("click"),$("#corregirpuntos"+t.options.idItentar).on("click",function(){var e=$(this).attr("indexCorregirPuntos");console.log("accion"),t._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),t._shouldScroll()||t._scrollToBottom(),$("#corregirpuntos"+e).unbind("click"),$("#corregirpuntos"+e).removeClass("goToChat"),$("#corregirpuntos"+e).attr("disabled","disabled"),t._consultaPuntos(),console.log("accion")}),t.options.idItentar++;else if("200"==i.internalCode){var s=i.payload.rewards,c=i.payload.rewardsToExpire,o=new Date,a=i.payload.expireDate,r="<div style='background: url(  https://widget-chatbot-colombia.mybluemix.net/anita/images/back.jpg) no-repeat; width: 225px; height: 152px; margin: auto;border-radius:10px; '>";r+="<h1 style='font-size: 21px; color: white ;text-align: center; margin: auto;padding-top: 20px;'>Actualmente tienes</h1>",new Date(a)<o&&(s-=c),r+="<p  style='color: #eab949 ; text-align: center; font-size: 30px;  padding-top: 1px'><strong style='font-weight:700'>"+s.toLocaleString()+"</strong></p>",r+="<p  style='color:white ; text-align: center; margin-bottom: 15px;font-size: 18px; line-height:6px;'>puntos</p>",r+="<h1  style='font-size: 11px; margin-top: 5px; color: white ; margin-left: 20px; text-align: center;'>por vencer al "+a+":</h1>",r+="<p style='color: white ; text-align: center; font-size: 19px; margin-left:10px;'><strong style='font-weight:600;'>"+c.toLocaleString()+'</strong><span style="font-size:13px; margin-top:6px;">Pts.</span></p>',r+="</div>",$("#escribiendo").remove(),t._messageLog.append('<div class="chat-widget-message-container" style="margin-top: 3px;"><div class="chat-widget-message received" style="width:100%;">'+r.toLocaleString()+"</div></div>"),t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),t._shouldScroll()||t._scrollToBottom(),setTimeout(function(){t._messageLog.append('<div class="chat-widget-message-container" style="margin-top:3px;"><div class="chat-widget-message received">dime, puedo ayudarte en algo mas?</div></div>'),t._shouldScroll()||(console.log("scroll"),t._scrollToBottom())},2e3)}}};var i=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=consultarPuntos&documentId="+e;console.log(i),xmlhttp.open("GET",i,!0),xmlhttp.withCredentials=!0,xmlhttp.send()},_consultaPromocion:function(){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");var e=this;xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText);console.log(t);var i="";$("#escribiendo").remove(),$(".divopt").remove(),$("conf").remove(),$(".chat-widget-message").remove(),$("#pagin").remove(),e._messageLog.append("<div class='chat-widget-message received contenedor '><div class='divOptionButton' style='text-align:center'>Seleciona Por Favor si Tienes Algunos de Estos Medios de Pago y Confirma tu Consulta</div><div class='inline'><a class='divopt activobtn cenco' id='TCENCO-' href='#'>Tarjeta Cencosud</a></div><div class='inline'><a class='divopt activobtn' id='AVAL-' href='#'>Tarjeta Grupo Aval</a></div><div class='inline'><a class='divopt activobtn' id='BBOG-' href='#'>Tarjeta Banco Bogota</a></div><div class='inline'><a class='divopt activobtn' id='BBVA-' href='#'>Tarjeta BBVA</a></div><div class='inline'><a class='divopt activobtn' id='COD-' href='#'>Tarjeta Codensa</a></div><div class='inline'><a class='divopt activobtn' id='ITAU-' href='#'>Tarjeta Itau</a></div><div class='confirmar confirmarbtn'><a class='conf ' href='#'>Confirmar</a></div></div>"),e._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),$(".chat-widget-message-log"+e.options.idcarrusel).slick({nextArrow:'<i class="slick-next fa-chevron-right"></i>',prevArrow:'<i class="slick-prev fa-chevron-left"></i>',slidesToShow:3}),e.options.idcarrusel++,e._shouldScroll()||e._scrollToBottom(),$(".activobtn").unbind("click"),$(".activobtn").on("click",function(){$(this).is("[disabled]")||("TCENCO-"==this.id&&(-1!=i.indexOf("TCENCO-")?($("#"+this.id).removeClass("current"),i=i.replace("TCENCO-",""),console.log(i)):(i+=this.id+"",$("#"+this.id).addClass("current"))),"AVAL-"==this.id&&(-1!=i.indexOf("AVAL-")?($("#"+this.id).removeClass("current"),i=i.replace("AVAL-",""),console.log(i)):(i+=this.id+"",$("#"+this.id).addClass("current"),console.log("entro else"),console.log(i))),"BBOG-"==this.id&&(-1!=i.indexOf("BBOG-")?($("#"+this.id).removeClass("current"),i=i.replace("BBOG-",""),console.log(i)):(i+=this.id+"",$("#"+this.id).addClass("current"),console.log("entro else"),console.log(i))),"BBVA-"==this.id&&(-1!=i.indexOf("BBVA-")?($("#"+this.id).removeClass("current"),i=i.replace("BBVA-",""),console.log(i)):(i+=this.id,$("#"+this.id).addClass("current"),console.log("entro else"),console.log(i))),"COD-"==this.id&&(-1!=i.indexOf("COD-")?($("#"+this.id).removeClass("current"),i=i.replace("COD-",""),console.log(i)):(i+=this.id,$("#"+this.id).addClass("current"),console.log("entro else"),console.log(i))),"ITAU-"==this.id&&(-1!=i.indexOf("ITAU-")?($("#"+this.id).removeClass("current"),i=i.replace("ITAU-",""),console.log(i)):(i+=this.id,$("#"+this.id).addClass("current"),console.log("entro else"),console.log(i))))}),$(".confirmarbtn").unbind("click"),$(".confirmarbtn").on("click",function(){if(!$(this).is("[disabled]")){var s=[],c=["TCENCO","AVAL","BBVA","BBOG","COD","ITAU"];i.split("-").forEach(function(e,t){c=c.filter(function(t){return t!==e})}),console.log(c);for(var o=0;o<Object.keys(t.items).length;o++){var a=!0;if(c.forEach(function(e,i){-1!=t.items[o].name.indexOf(e)&&(a=!1)}),a&&-1!=t.items[o].description.indexOf("*")){const e=/\*.*\*/g,i=t.items[o].description;let c;for(;null!==(c=e.exec(i));)c.index===e.lastIndex&&e.lastIndex++,c.forEach(function(e,i){e=e.replace(/\*/g,"");var c=new Date;fechainit=t.items[o].beginDate,fechaend=t.items[o].endDate,fechainit=new Date(fechainit),fechaend=new Date(fechaend),c>=fechainit&&c<=fechaend&&(console.log(t),s.push({id:t.items[o].idCalculatorConfiguration,description:e})),$(".activobtn").attr("disabled","disabled"),$(".confirmarbtn").attr("disabled","disabled")})}}var r="<p class='chat-widget-message received'>Haz click en una de nuestras promociones para ver los productos con descuentos.</p>";e._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),r+="<div class='chat-widget-message received'>";for(var n=0;n<Object.keys(s).length;n++)r+="<div class='line-content'><a id='"+s[n].id+"' class='divopt cs search-product'  href='#'>"+s[n].description+"</a></div>";r+="</div>",e._messageLog.append(r),e._messageLog.append('<ul id="pagin" class="cs"></ul>'),e._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),pageSize=4;var d=$(".line-content").length/pageSize;for(o=0;o<d;o++)$("#pagin").append('<li><a class="paginacion" href="#">'+(o+1)+"</a></li> ");$("#pagin li").first().find("a").addClass("current"),showPage=function(e){$(".line-content").hide(),$(".line-content").each(function(t){t>=pageSize*(e-1)&&t<pageSize*e&&$(this).show()})},showPage(1),$("#pagin li a").click(function(){$("#pagin li a").removeClass("current"),$(this).addClass("current"),showPage(parseInt($(this).text()))}),e._shouldScroll()||e._scrollToBottom(),$(".search-product").on("click",function(){e._consultaPromocionesProducto(this),$(this).addClass("current"),$(this).attr("disabled","disabled")})}})}},xmlhttp.open("GET"," https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=consultarPromociones",!0),xmlhttp.withCredentials=!0,xmlhttp.send()},_consultaPromocionesProducto:function(e,t){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");var i=this;xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){console.log(this.responseText);var e=JSON.parse(this.responseText),s=(JSON.parse(this.responseText),e.productos);if(e.card,Object.keys(s).length<=0)return $("#escribiendo").remove(),void i._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">No existen aun productos asociados a esta promocion.</div></div>');for(var c="",o='<div class="chat_producto_slider'+i.options.idcarrusel+' chat_producto_slider responsive" style="text-align:center">',a=[],r=0;r<Object.keys(s).length;r++){c+=s[r].productName.toLowerCase()+"<br>";var n=[];if(s[r].items[0].sellers[0].commertialOffer.AvailableQuantity>0){n.nombre=i.quitaacentos(s[r].productName.toLowerCase()),n.id=s[r].productId,n.precio=s[r].items[0].sellers[0].commertialOffer.Price,n.addtocartlink=s[r].items[0].sellers[0].addToCartLink,o+="<div>",o+="<a style='width:97%;' href='"+s[r].link+"'><img style='margin:auto;height:130px' src='"+s[r].items[0].images[0].imageUrl+"' /></a>",o+="<div class='info-description'>",o+="<h3 class='chatProductName'>"+n.nombre+" </h3>";var d=s[r].items[0].sellers[0].commertialOffer.ListPrice,p=s[r].items[0].sellers[0].commertialOffer.Price;p<d&&(o+="<span class='txt-gris'>Precio Regular $"+d.toLocaleString()+"</span>"),o+="<span class='txt-verde'>Precio Ahora $<strong>"+p.toLocaleString()+"</strong></span>";for(var l=[],u=0;u<Object.keys(s[r].items[0].sellers[0].commertialOffer.Teasers).length;u++)if(!(Object.keys(s[r].items[0].sellers[0].commertialOffer.Teasers).length<=0)){console.log(Object.keys(s[r].items[0].sellers[0].commertialOffer.Teasers).length);var m=s[r].items[0].sellers[0].commertialOffer.Teasers[u]["<Name>k__BackingField"].split("-"),v=Math.round(s[r].items[0].sellers[0].commertialOffer.PriceWithoutDiscount-s[r].items[0].sellers[0].commertialOffer.PriceWithoutDiscount*(m[1]/100));switch(v=v.toLocaleString(),m[0]){case"PCENCO":if(null==l.PCENCO){l.PCENCO=[],l.PCENCO.descuento=v,l.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+v+"</span></div>";break}if(null==l.PCENCO.descuento){l.PCENCO.descuento=v,l.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+v+"</span></div>";break}if(l.PCENCO.descuento<v){l.PCENCO.descuento=v,l.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+v+"</span></div>";break}case"VISA":if(null==l.VISA){l.VISA=[],l.VISA.descuento=v,l.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+v+"</span></div>";break}if(null==l.VISA.descuento){l.VISA.descuento=v,l.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+v+"</span></div>";break}if(l.VISA.descuento<v){l.VISA.descuento=v,l.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+v+"</span></div>";break}case"AMEX":if(null==l.AMEX){l.AMEX=[],l.AMEX.descuento=v,l.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+v+"</span></div>";break}if(null==l.AMEX.descuento){l.AMEX.descuento=v,l.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+v+"</span></div>";break}if(l.AMEX.descuento<v){l.AMEX.descuento=v,l.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+v+"</span></div>";break}case"COLP":if(null==l.COLP){l.COLP=[],l.COLP.descuento=v,l.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+v+"</span></div>";break}if(null==l.COLP.descuento){l.COLP.descuento=v,l.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+v+"</span></div>";break}if(l.COLP.descuento<v){l.COLP.descuento=v,l.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+v+"</span></div>";break}case"BBVA":if(null==l.BBVA){l.BBVA=[],l.BBVA.descuento=v,l.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+v+"</span></div>";break}if(null==l.BBVA.descuento){l.BBVA.descuento=v,l.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+v+"</span></div>";break}if(l.BBVA.descuento<v){l.BBVA.descuento=v,l.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+v+"</span></div>";break}case"AVAL":if(null==l.AVAL){l.AVAL=[],l.AVAL.descuento=v,l.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+v+"</span></div>";break}if(null==l.AVAL.descuento){l.AVAL.descuento=v,l.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+v+"</span></div>";break}if(l.AVAL.descuento<v){l.AVAL.descuento=v,l.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+v+"</span></div>";break}case"TCENCO24":if(null==l.TCENCO24){l.TCENCO24=[],l.TCENCO24.descuento=v,l.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(null==l.TCENCO24.descuento){l.TCENCO24.descuento=v,l.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(l.TCENCO24.descuento<v){l.TCENCO24.descuento=v,l.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}case"COD":if(null==l.COD){l.COD=[],l.COD.descuento=v,l.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+v+"</span></div>";break}if(null==l.COD.descuento){l.COD.descuento=v,l.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+v+"</span></div>";break}if(l.COD.descuento<v){l.COD.descuento=v,l.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+v+"</span></div>";break}case"TCENCO":if(null==l.TCENCO){l.TCENCO=[],l.TCENCO.descuento=v,l.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(null==l.TCENCO.descuento){l.TCENCO.descuento=v,l.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(l.TCENCO.descuento<v){l.TCENCO.descuento=v,l.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}case"BBOG":if(null==l.BBOG){l.BBOG=[],l.BBOG.descuento=v,l.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+v+"</span></div>";break}if(null==l.BBOG.descuento){l.BBOG.descuento=v,l.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+v+"</span></div>";break}if(l.BBOG.descuento<v){l.BBOG.descuento=v,l.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+v+"</span></div>";break}case"ITAU":if(null==l.ITAU){l.ITAU=[],l.ITAU.descuento=v,l.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+v+"</span></div>";break}if(null==l.ITAU.descuento){l.ITAU.descuento=v,l.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+v+"</span></div>";break}if(l.ITAU.descuento<v){l.ITAU.descuento=v,l.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+v+"</span></div>";break}case"MCARD":if(null==l.MCARD){l.MCARD=[],l.MCARD.descuento=v,l.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+v+"</span></div>";break}if(null==l.MCARD.descuento){l.MCARD.descuento=v,l.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+v+"</span></div>";break}if(l.MCARD.descuento<v){l.MCARD.descuento=v,l.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+v+"</span></div>";break}case"CVAL":null!=l.CVAL?null==l.CVAL.descuento?(l.CVAL.descuento=v,l.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+v+"</span></div>"):l.CVAL.descuento<v&&(l.CVAL.descuento=v,l.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+v+"</span></div>"):(l.CVAL=[],l.CVAL.descuento=v,l.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+v+"</span></div>")}}for(var _ in console.log(l),l)null!=l[_].contenido&&(o+=l[_].contenido);o+="<a class='btn btn-naranja chat_addtocart ' prod_nombre='"+n.nombre+"' prod_id='"+n.id+"' prod_precio='"+n.precio+"' prod_addtocartlink='"+n.addtocartlink+"' href='#'><i class='fa fa-shopping-cart' aria-hidden='true'></i><strong>Comprar</strong></a>",o+="<span class='line'></span>",o+="<div  class='flex-container'>",o+="<a href='"+s[r].link+"'class='btn btn-gris flex'><i class='fa fa-search-plus' aria-hidden='true'></i> <strong>  Ver Producto</strong></a>",o+="<a href='https://www.tiendasjumbo.co/busca/?ft="+t+"' class='btn btn-gris'><i class='fa fa-shopping-basket' aria-hidden='true'></i> <strong>  Relacionados</strong></a>",o+="</div>",o+="</div>",o+="</div>",a.push({name:n.nombre,id:n.id,price:n.precio,brand:"",category:"",variant:"",list:"Chatbot Vista Productos",position:r})}}o+="</div>",Object.keys(a).length>0?(i._guardarEnBase("recibo","message="+c),"undefined"!=typeof dataLayer&&dataLayer.push({event:"ConsultaProductoChatbot",consulta:t,ecommerce:{currencyCode:"PEN",impressions:a}}),$("#escribiendo").remove(),i._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">'+o+"</div></div>"),i._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>')):($("#escribiendo").remove(),i._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">No existen productos asociados a esta Promocion.</div></div>'),i._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>')),i._shouldScroll()||i._scrollToBottom(),$(".chat_producto_slider"+i.options.idcarrusel).slick({nextArrow:'<i class="slick-next fa-chevron-right"></i>',prevArrow:'<i class="slick-prev fa-chevron-left"></i>'}),i.options.idcarrusel++,$(".chat_addtocart").on("click",function(){var e=this.getAttribute("prod_nombre"),t=this.getAttribute("prod_id"),s=this.getAttribute("prod_precio"),c=this.getAttribute("prod_addtocartlink");i.agregarCarro(e,t,s,c)})}},$("#escribiendo").remove(),this._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">Por favor aguarde un momento mientras consulto  los  productos asociados a esta Promocion.</div></div>'),this._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),this._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),this._shouldScroll()||this._scrollToBottom(),"%20Dulce Pasion"==t&&(t="torta&fq=B:2211");var s=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=consultarProductoPromo&idPromo="+e.id;console.log(s),xmlhttp.open("GET",s,!0),xmlhttp.withCredentials=!0,xmlhttp.send()},_agregarPunto:function(e){var t=/(\d+)(\d{2})/;return String(e).replace(/^\d+/,function(e){for(;t.test(e);)e=e.replace(t,"$1.$2");return e})},_formatDate:function(e){if(null==e)return"SIN INFORMACIÓN";var t=new Date(e),i=""+(t.getMonth()+1),s=""+t.getDate(),c=t.getFullYear();return i.length<2&&(i="0"+i),s.length<2&&(s="0"+s),[s,i,c].join("-")},quitaacentos:function(t){return á="a",é="e",í="i",ó="o",ú="u",ä="a",ë="e",ï="i",ö="o",ü="u",acentos=/[áéíóúäëïöü]/g,t=t.replace(/("|')/g,""),t.replace(acentos,function($1){return eval($1)})},enviarOpcion:function(e){this.sendMessage(e.innerHTML.replace(/<(?:.|\n)*?>/gm,""),"opcion")},formularioTransferir:function(){var e="",t="",i="",s="";if("undefined"!=typeof dataLayer&&void 0!==dataLayer[3]&&void 0!==dataLayer[3].visitorContactInfo&&(void 0!==dataLayer[3].visitorContactInfo[1]&&""!=dataLayer[3].visitorContactInfo[1]&&(e=dataLayer[3].visitorContactInfo[1]),void 0!==dataLayer[3].visitorContactInfo[2]&&""!=dataLayer[3].visitorContactInfo[2]&&(e+=" "+dataLayer[3].visitorContactInfo[2]),void 0!==dataLayer[3].visitorContactInfo[0]&&""!=dataLayer[3].visitorContactInfo[0])){t=dataLayer[3].visitorContactInfo[0];var c=this;window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);console.log(e),i=e[0].homePhone,s=e[0].document}};var o=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=datosUsuario&email="+t;xmlhttp.open("GET",o,!1),xmlhttp.withCredentials=!0,xmlhttp.send()}var a=this.options.idmensaje;this.options.idmensaje++,$(".carruselOpciones").remove(),$(".chat-widget-message-log").append('<div class="chat-widget-message-container"><div style="background-color:#f5f4f4;" class="chat-widget-message received" id="transferidoDiv">Completa el formulario y te transfiero con un Ejecutivo Jumbo.<p style="padding-bottom:5px;"></p><input style="display:none;" id="id" value="'+this.options.idChatActual+'" />Nombre*<input style="padding:3px 2px 3px 2px;margin:4px 0 8px 0;width:100%" type="text" name="txtNombre" id="nombre" value="'+e+'">Teléfono<br/><input style="padding:3px 2px 3px 2px;margin:4px 0 8px 0;width:100%" type="text" id="telefono" name="txtTelefono" value="'+i+'">Documento de Identidad*<input style="padding:3px 2px 3px 2px;margin:4px 0 8px 0;width:100%" type="text" name="txtDni" id="dni" value="'+s+'">Email*<input style="padding:3px 2px 3px 2px;margin:4px 0 8px 0;width:100%" type="text" name="email" id="email" value="'+t+'"><button style="margin-top:20px;border: 1px solid #119F3D;border-radius: 5px;" class="goToChat"><i style="margin-right: 5px; float: left; margin-left: 5px;"></i><label style="text-align: center;">ENTRAR</label></button></div></div>'),$(".chat-widget-message-log").scrollTop($(".chat-widget-message-log").prop("scrollHeight")),c=this,$(".goToChat").on("click",function(){c.chatHumano(a)})},chatHumano:function(e){var t=document.querySelector('input[name="rating'+e+'"]:checked'),i=0;null!=t&&(i=t.value);var s=document.getElementById("nombre").value,c=document.getElementById("telefono").value,o=!0,a=document.getElementById("dni").value,r=document.getElementById("email").value;""==s&&(document.getElementById("nombre").style.background="red",document.getElementById("nombre").setAttribute("onkeyup","this.style.background = 'white'")),""!=c&&(/[0-9]/.test(c)||(o=!1,document.getElementById("telefono").style.background="red",document.getElementById("telefono").setAttribute("onkeyup","this.style.background = 'white'"))),""==a&&(document.getElementById("dni").style.background="red",document.getElementById("dni").setAttribute("onkeyup","this.style.background = 'white'"));var n=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(""!=r&&n.test(r)||(document.getElementById("email").style.background="red",document.getElementById("email").setAttribute("onkeyup","this.style.background = 'white'")),""!=s&&""!=a&&""!=r&&n.test(r)&&0!=o){""==c&&(c=0),window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);console.log(e),e.id,"undefined"!=typeof dataLayer&&dataLayer.push({event:"transferidoChatHumano"})}};var d=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=transferir",p="nombre="+s+"&telefono="+c+"&dni="+a+"&email="+r+"&score="+i;null!=p&&(d+="&"+p),xmlhttp.open("GET",d,!0),xmlhttp.withCredentials=!0,xmlhttp.send()}},calificar:function(){var e=document.querySelector('input[name="rating"]:checked'),t=0,i=document.querySelector('input[name="nombre"]').value,s=document.querySelector('input[name="telefono"]').value,c=document.querySelector('input[name="email"]').value,o=1;if(""==i&&(document.querySelector('input[name="nombre"]').style.background="red",document.querySelector('input[name="nombre"]').setAttribute("onkeyup","this.style.background = 'white'")),""==c?(document.querySelector('input[name="email"]').style.background="red",document.querySelector('input[name="email"]').setAttribute("onkeyup","this.style.background = 'white'")):/^[-\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\.){1,125}[A-Z]{2,63}$/i.test(c)||(document.querySelector('input[name="email"]').style.background="red",document.querySelector('input[name="email"]').setAttribute("onkeyup","this.style.background = 'white'"),o=0),null!=e?(t=e.value,document.getElementById("noCalifico").style.display="none"):document.getElementById("noCalifico").style.display="block",""!=i&&""!=t&&""!=c&&0!=o){document.getElementById("calificacionSend").disabled=!0,document.querySelector('input[name="rating"]').disabled=!0,$(".received input[type=text]").disabled=!0;var a=this;window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&($("#escribiendo").remove(),$(".chat-widget-message-log").append('<div style="padding-top:5px" class="chat-widget-message-container"><div class="chat-widget-message received">Muchas gracias, tu clasificación ayuda con mi entrenamiento</div></div>'),a._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),a._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),$(".chat-widget-message-log").scrollTop($(".chat-widget-message-log").prop("scrollHeight")),a.sleep(2e3),1!=a.options.calificación?(a._hideChat(),$("#escribiendo").remove()):($("#escribiendo").remove(),a._hideChat()),console.log(this.responseText))},this._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>');var r=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=rating",n="score="+t;n+="&nombre="+i,n+="&telefono="+s,n+="&email="+c,null!=(n+="&comentario="+document.querySelector('textarea[name="comentario"]').value)&&(r+="&"+n),xmlhttp.open("GET",r,!0),xmlhttp.withCredentials=!0,xmlhttp.send()}},calificarCerrar:function(){var e=document.querySelector('input[name="rating2"]:checked'),t=0,i=document.querySelector('input[name="nombre"]').value,s=document.querySelector('input[name="telefono"]').value,c=document.querySelector('input[name="email"]').value,o=1;if(""==i&&(document.querySelector('input[name="nombre"]').style.background="red",document.querySelector('input[name="nombre"]').setAttribute("onkeyup","this.style.background = 'white'")),""==c?(document.querySelector('input[name="email"]').style.background="red",document.querySelector('input[name="email"]').setAttribute("onkeyup","this.style.background = 'white'")):/^[-\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\.){1,125}[A-Z]{2,63}$/i.test(c)||(document.querySelector('input[name="email"]').style.background="red",document.querySelector('input[name="email"]').setAttribute("onkeyup","this.style.background = 'white'"),o=0),null!=e?(t=e.value,document.getElementById("noCalifico").style.display="none"):document.getElementById("noCalifico").style.display="block",""!=i&&""!=t&&""!=c&&0!=o){document.getElementById("calificacionSend2").disabled=!0,document.querySelector('input[name="rating2"]').disabled=!0,$(".received input[type=text]").disabled=!0;var a=this;window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&($("#escribiendo").remove(),$(".chat-widget-message-log").append('<div style="padding-top:5px" class="chat-widget-message-container"><div class="chat-widget-message received">Muchas gracias, tu clasificación ayuda con mi entrenamiento</div></div>'),a._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),a._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),$(".chat-widget-message-log").scrollTop($(".chat-widget-message-log").prop("scrollHeight")),$("#escribiendo").remove(),$(".calificar-cerrar").remove(),a._hideChat())},this._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>');var r=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=rating",n="score="+t;n+="&nombre="+i,n+="&telefono="+s,n+="&email="+c,null!=(n+="&comentario="+document.querySelector('textarea[name="comentario"]').value)&&(r+="&"+n),xmlhttp.open("GET",r,!0),xmlhttp.withCredentials=!0,xmlhttp.send()}},verProductosPedido:function(e){"Ver Productos"==e.text?(document.getElementById("tblOrden").style.display="block",e.text="Ocultar Productos"):(document.getElementById("tblOrden").style.display="none",e.text="Ver Productos")},agregarCarro:function(e,t,i,s){"undefined"!=typeof dataLayer&&dataLayer.push({event:"addToCartChat",ecommerce:{currencyCode:"PEN",add:{products:[{name:e,id:t,price:i,brand:"",category:"",variant:"",quantity:1}]}}}),window.location.href=s},sleep:function(e){for(var t=(new Date).getTime(),i=0;i<1e7&&!((new Date).getTime()-t>e);i++);},_restartChat:function(){$("#chat-widget").show(),console.log("restartchat")},_removeChat:function(){$("#chat-widget").hide(),console.log("removechat")},bindEvent:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)}}),$.widget("ibm.chatwidget",{options:{name:"¡Hola! Soy Juanita",avatarImage:"https://widget-chatbot-colombia.mybluemix.net/anita/images/avatar_co-original.png",iniciado:0,idmensaje:0,idcarrusel:0,idcarrusel_opciones:0,idFormPuntos:0,calificaron:!1,calificion:0,idChatActual:0,enviomensaje:0},_create:function(){this._avatar=$('<div class="dragable" id="dragable" style="cursor: pointer;"><div id="ChatAvatarDiv" class="chat-widget-avatar"><img class="Img-avatar" src=" https://widget-chatbot-colombia.mybluemix.net/anita/images/avatar_co-original.png"><div id="msg"></div></div></div>'),this._messageAvatar=$('<img class="chat-widget-avatar-message" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/avatar_co-original.png">'),this._messageContainer=$('<div class="chat_widget-message-container"></div>'),this._panel=$('<div class="chat-widget-panel"></div>'),this._header=$('<div class="chat-widget-header"></div>'),this._messageLog=$('<div id="style-3" class="chat-widget-message-log"><div class="contenedor-loader"><div class="lds-ring"><div></div><div></div><div></div><div></div></div><div class="contenedor-conectando"><p class="conectando">conectando...</p></div></div></div>'),this._messageDock=$('<div class="chat-widget-message-dock"></div>'),this._assistantStatus=$('<img class="anitaImg ima-responsive hidden-xs" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/avatar_co-original.png"> \t\t\t\t<div style="display: flex;flex-direction: column;margin-right:9px;">    <span class="chat-widget-assistant-name">'+this.options.name+'</span> \t\t\t\t<span style="font-size: 10px;color: #ffffff;display: flex;justify-content: left;margin-top: 0; text-transform: uppercase;">Tu Robot Virtual de Jumbo</span> \t\t\t\t </div> \t\t\t\t'),this._headerButtons=$('<div style="" class="chat-widget-header-buttons"><a class="close-button"><i class="fa fa-times" aria-hidden="true"></i></a></div>'),this._messageInput=$('<input type="text" placeholder="Escribe un mensaje..." rows="3" data-min-rows="3" class="autoExpand chat-widget-message-input" autocomplete="off"/>'),this._messageSubmitButton=$('<button type="submit"><i class="fa fa-paper-plane" style="font-size:15px;color:#323232" aria-hidden="true"></i></button>'),this._header.append(this._assistantStatus,this._headerButtons),this._messageDock.append(this._messageInput,this._messageSubmitButton),this._panel.append(this._header,this._messageLog,this._messageDock),this.element.append(this._panel,this._avatar),Draggable.create("#dragable",{onClick:function(){},onDragStart:function(e){$("#dragable").addClass("dragging")},onDragEnd:function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),$("#dragable").removeClass("dragging")}}),$(document).on("click","#dragable.dragging",function(){e.stopPropagation(),e.preventDefault(),alert("native click")}),function e(){$(function(){var e=window.location.pathname,t=navigator.userAgent||navigator.vendor||window.opera,i=0,s=0;-1!=e.indexOf("cart")&&(i=1),-1!=e.indexOf("checkout")&&(s=1),-1!=$(".minicart__totalizer--amount span").text().indexOf("0")?1==i||1==s?(console.log("entro al if carrito"),(t.match(/Android/i)||/iPhone/.test(t))&&($("#chat-widget").css("cssText","bottom: 2% !important;"),$("#chat-widget").css("left","4%"),$("#chat-widget").css("align-items","end"))):(t.match(/Android/i)||/iPhone/.test(t),$("#chat-widget").css("cssText","bottom: 5% !important;"),$("#chat-widget").css("right","2%"),$("#chat-widget").css("align-items","flex-end")):(t.match(/Android/i)||/iPhone/.test(t)?($("#chat-widget").css("cssText","bottom: 2% !important;"),$("#chat-widget").css("left","4%"),$("#chat-widget").css("align-items","end")):($("#chat-widget").css("cssText","bottom: 5% !important;"),$("#chat-widget").css("right","2%"),$("#chat-widget").css("align-items","flex-end")),/iPhone/.test(navigator.userAgent))}),setTimeout(e,1e3)}(),this.element.addClass("chat-widget"),this._panel.hide(),this._is_active=!1;var t=this;$(".chatHumanoBtn").on("click",function(){t.sendMessage("Agente Jumbo","opcion")}),$(function(){if(!$.support.placeholder){var e=document.activeElement;$(".chat-widget-message-input").focus(function(){""!=$(this).attr("placeholder")&&$(this).val()==$(this).attr("placeholder")&&$(this).attr("placeholder","")}).blur(function(){$(this).attr("placeholder","Escribir un Mensaje...")}),$(".chat-widget-message-input").blur(),$(e).focus(),$("form").submit(function(){$(this).attr("placeholder","")})}}),t.bindEvent(window,"message",function(e){"inicioInconcert"==e.data&&t._removeChat(),"cerrarChat"==e.data&&($("#loadinginconcertChat").remove(),$(".fixClose").remove(),$("#transferidoDiv").html("Transferido"),t._guardarEnBase("historial",'message=<div class="chat-widget-message-container"><div class="chat-widget-message received">Espero te hayan podído ayudar. Voy a seguir entrenandome con este tema para intentar ayudarte la próxima vez. Cualquier otra cosa puedes escribirme</div></div><div class="chat-widget-message-container"><p class="timerecived">'+t.getCurrentTime()+"</p></div>"),t._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">Espero te hayan podído ayudar. Voy a seguir entrenandome con este tema para intentar ayudarte la próxima vez. Cualquier otra cosa puedes escribirme</div></div>'),t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived">'+t.getCurrentTime()+"</p></div>"),t._shouldScroll()||t._scrollToBottom(),t._restartChat())}),t.options.idmensaje++,this._on(this.element,{"click .chat-widget-avatar":function(){this._toggleChat()},"click .chat-widget-header-buttons .close-button":function(){0===this.options.enviomensaje?(this._hideChat(),$(".calificar-cerrar").remove()):!1===this.options.calificaron?this._cerrarChat():(this._hideChat(),$(".calificar-cerrar").remove())},"click .chat-widget-header-buttons #cerrar-chat-button":function(){this._hideChat()},"click #cerrar-chat-button":function(){this._hideChat(),$(".calificar-cerrar").remove()},'click button[type="submit"]':function(){this._submitMessage()},"keyup .chat-widget-message-input":function(e){13==e.keyCode&&this._submitMessage()}}),this.element.one("focus.autoExpand","textarea.autoExpand",function(){var e=this.value;this.value="",this.baseScrollHeight=this.scrollHeight,this.value=e}).on("input.autoExpand","textarea.autoExpand",function(){var e,t=0|this.getAttribute("data-min-rows");this.rows=t,e=Math.ceil((this.scrollHeioptionght-this.baseScrollHeight)/17),this.rows=t+e}),this._scrollToBottom()},_toggleChat:function(){this._is_active?this._hideChat():this.showChat()},prueba:function(){alert("prueba")},showChat:function(){if(0==this.options.iniciado){$(".chat-widget-message-input").attr("disabled","disabled"),$(".chat-widget-message-input").attr("placeholder",""),this._guardarEnBase("iniciar"),this.options.iniciado=1,this._socket=new WebSocket("wss://chatbot-colombia-red-dev.mybluemix.net/ws/jumbo");var e=this;this._socket.onopen=function(){console.log("Connected"),$(".chat-widget-message-input").prop("disabled",!1),$(".chat-widget-message-input").attr("placeholder","Escribe un mensaje..."),$(".contenedor-loader").remove(),function t(){e._socket.readyState==e._socket.OPEN&&e._socket.send(JSON.stringify({type:"command",message:"/keepalive"})),setTimeout(t,3e4)}()},this._socket.onmessage=function(t){var i=JSON.parse(t.data);console.log(i),"message"==i.type?(e.receiveMessage(i.message),i.message=i.message.toUpperCase(),i.message):"command"==i.type&&"escribiendo"==i.command&&e._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>')},this._socket.onclose=function(){option,console.log("Disconnected")}}var t;this._panel.show("fade",200).css("display","flex"),this._is_active=!0,this._avatar.hide(),"undefined"!=typeof dataLayer&&(console.log(dataLayer),dataLayer.push({event:"chatIniciado"})),t=navigator.userAgent||navigator.vendor||window.opera,/iPad|iPhone|iPod/.test(t)&&!window.MSStream&&$("meta[name=viewport]").attr("content","width=device-width,initial-scale=1,maximum-scale=1.0"),$(".style-2").fadeOut(4e3)},_hideChat:function(){var e,t=this;this._avatar.show("fade",200),t._panel.hide("fade",200,function(){t._is_active=!1}),e=navigator.userAgent||navigator.vendor||window.opera,/iPad|iPhone|iPod/.test(e)&&!window.MSStream&&$("meta[name=viewport]").attr("content","width=device-width,initial-scale=1.0")},_cerrarChat:function(){self=this;var e="",t="";"undefined"!=typeof dataLayer&&void 0!==dataLayer[3]&&void 0!==dataLayer[3].visitorContactInfo&&(void 0!==dataLayer[3].visitorContactInfo[1]&&""!=dataLayer[3].visitorContactInfo[1]&&(e=dataLayer[3].visitorContactInfo[1]),void 0!==dataLayer[3].visitorContactInfo[2]&&""!=dataLayer[3].visitorContactInfo[2]&&(e+=" "+dataLayer[3].visitorContactInfo[2]),void 0!==dataLayer[3].visitorContactInfo[0]&&""!=dataLayer[3].visitorContactInfo[0]&&(t=dataLayer[3].visitorContactInfo[0])),$(".chat-widget-panel").append('<div  class="calificar-cerrar" id="calificar-cerrar"><div style="" class="chat-widget-message-container"><div class="chat-widget-message received"><fieldset style="margin-bottom: 10px; text-align:center;" class="rating2"><legend style="padding-bottom:10px; width:100%; text-align: center;">Quisieras colaborar con mi entrenamiento? Como calificarías mi atención?</legend><leyend id="noCalifico" style="color:red;clear:both;width:100%;float:left;display:none;">Favor selecciona tu calificación</leyend><span class="rating2"><input type="radio" id="cal5" name="rating2" value="5" /><label for="cal5" title="Genial!">5 Estrellas</label><input type="radio" id="cal4" name="rating2" value="4" /><label for="cal4" title="Muy buena">4 Estrellas</label>    <input type="radio" id="cal3" name="rating2" value="3" /><label for="cal3" title="Buena">3 Estrellas</label>    <input type="radio" id="cal2" name="rating2" value="2" /><label for="cal2" title="Algo ayudo">2 Estrellas</label>    <input type="radio" id="cal1" name="rating2" value="1" /><label for="cal1" title="Perdida de tiempo">1 Estrella</label></span></fieldset><div class="linea"></div><div class="flex-container"><a class="btn-no-gracias" id="cerrar-chat-button" tabindex="0"><strong>No gracias</strong></a></div><div id="divAdicionalRating2" style="display:none"><input style="width:100%;padding:4px;margin-top:4px;padding-left:15px" name="nombre" placeholder="Nombre*" value="'+e+'"/><input style="width:100%;padding:4px;margin-top:4px;padding-left:15px" name="email" placeholder="Email*" value="'+t+'"/><input style="margin-top:4px;width:100%;padding:4px;padding-left:15px" name="telefono" placeholder="Telefono" /><textarea name="comentario" rows="3" data-min-rows="3" class="autoExpand" style="width:100%;padding-left:15px;padding-top:5px;margin-top:4px" placeholder="Ingresa el motivo de la calificación..." autocomplete="off"></textarea><button id="calificacionSend2" class="calificacionBtn2"><i style="margin-right: 5px; float: left; margin-left: 5px;"></i><label style="text-align: center;">ENVIAR</label></button><div class="flex-container"><a class="btn-no-gracias" id="cerrar-chat-button" tabindex="0"><strong>No gracias</strong></a></div></div></div></div></div>'),$(".rating2").on("click",function(){"none"==$("#divAdicionalRating2").css("display")&&($("#cerrar-chat-button").remove(),$(".linea").remove(),$("#divAdicionalRating2").show(),$(".calificar-cerrar").css("padding-top","60px"),$(".chat-widget-message-log").scrollTop($(".chat-widget-message-log").prop("scrollHeight")))}),$(".calificacionBtn2").on("click",function(){self.calificarCerrar()})},_submitMessage:function(){var e=this.getInput();""==e||(this.sendMessage(e),this.clearInput())},_shouldScroll:function(){return this._messageLog.scrollTop()+this._messageLog.prop("clientHeight")===this._messageLog.prop("scrollHeight")},_scrollToBottom:function(){this._messageLog.scrollTop(this._messageLog.prop("scrollHeight"))},getInput:function(){return this._messageInput.val().replace(/\r?\n/gi,"")},clearInput:function(){this._messageInput.val("")},sendMessage:function(e,t){e=this.quitaacentos(e),console.log("enviando mensaje:"+e);var i={type:"message",message:e,session:this.options.idChatActual};this._guardarEnBase("envio","message="+e),this.options.enviomensaje=1;var s="";void 0!==t&&"opcion"==t&&(s=" sendOpcion"),this._messageLog.append('<span class="chat-widget-message-container-received"><p class="chat-widget-message sent'+s+'">'+e+"</p></span>"),this._messageLog.append('<span class="chat-widget-message-container-received"><p class="timesent">'+this.getCurrentTime()+"</p></span>"),this._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),this._guardarEnBase("historial",'message=<span class="chat-widget-message-container-received"><p class="chat-widget-message sent'+s+'">'+e+'</p></span><span class="chat-widget-message-container-received"><p class="timesent">'+this.getCurrentTime()+"</p></span>"),this._socket.send(JSON.stringify(i)),this._shouldScroll()||this._scrollToBottom()},receiveMessage:function(e){var t=0;if(-1!=e.indexOf("--start--")){var i="";"undefined"!=typeof dataLayer&&void 0!==dataLayer[3]&&void 0!==dataLayer[3].visitorContactInfo&&void 0!==dataLayer[3].visitorContactInfo[1]&&""!=dataLayer[3].visitorContactInfo[1]&&(i=dataLayer[3].visitorContactInfo[1]),e=e.replace("Hola","Hola "+i),$("#escribiendo").remove(),e=e.replace("--start--","");var s='<div class="chat-widget-message received">                        Te puedo ayudar con estos temas                        <ul>                            <li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/carrito.svg" /> Comprar un producto</a></li>                            <li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/envios.svg" /> Status de un pedido</a></li>\t\t\t\t\t\t\t<li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/promociones.svg" /> Promociones</a></li>\t\t\t\t\t\t\t<li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/nuestrastiendas.svg" /> Información de Tiendas</a></li>\t\t\t\t\t\t\t<li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/pregfrecuentes.svg" /> Preguntas Frecuentes</a></li>\t\t\t\t\t\t</ul>                    </div>';this._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">'+e+"</div></div>"),this._messageLog.append(s),this._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">O dime en que te puedo ayudar</div></div>'),this._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived">'+this.getCurrentTime()+"</p></div>");var c=this;$(".btn-verde").on("click",function(){"undefined"!=typeof dataLayer&&dataLayer.push({event:"chatbotAction",accion:"botones",categoria:"chatbot",etiqueta:this.innerHTML.replace(/<(?:.|\n)*?>/gm,"")}),c.enviarOpcion(this)}),this.options.idcarrusel_opciones++,this._shouldScroll()||this._scrollToBottom()}else if(-1!=e.indexOf("--informacion_de_tiendas--")){$("#escribiendo").remove(),e=e.replace("--informacion_de_tiendas--","");s='<div class="chat-widget-message received">                        Te puedo ayudar con estos temas                        <ul>                            <li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/horarios.svg" /> Horarios</a></li>                            <li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/ubicacion1.svg" /> Direcciones</a></li>\t\t\t\t\t\t\t<li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/telefonos.svg" /> Telefonos</a></li>                        </ul>                    </div>';this._messageLog.append(s);c=this;$(".btn-verde").on("click",function(){"undefined"!=typeof dataLayer&&dataLayer.push({event:"chatbotAction",accion:"botones",categoria:"chatbot",etiqueta:this.innerHTML.replace(/<(?:.|\n)*?>/gm,"")}),c.enviarOpcion(this)}),this.options.idcarrusel_opciones++,this._shouldScroll()||this._scrollToBottom()}else if(-1!=e.indexOf("--preguntas_generales--")){$("#escribiendo").remove(),e=e.replace("--preguntas_generales--",""),this._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">'+e+"</div></div>"),this._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived">'+this.getCurrentTime()+"</p></div>");s='<div class="chat-widget-message received">                        Te puedo ayudar con estos temas                        <ul>                            <li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/terminosycondiciones.svg" /> Terminos y Condiciones</a></li>                            <li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/ubicacion1.svg" /> Contactanos</a></li>\t\t\t\t\t\t\t<li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/retractodecompra.svg" /> Retracto de Compra</a></li>\t\t\t\t\t\t\t<li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/garantias.svg" /> Garantías</a></li>\t\t\t\t\t\t\t<li><a class="btn btn-verde "><img style="width:35px" src="https://widget-chatbot-colombia.mybluemix.net/anita/images/condenvio.svg" /> Condiciones de Envío</a></li>                        </ul>                    </div>';this._messageLog.append(s);c=this;$(".btn-verde").on("click",function(){"undefined"!=typeof dataLayer&&dataLayer.push({event:"chatbotAction",accion:"botones",categoria:"chatbot",etiqueta:this.innerHTML.replace(/<(?:.|\n)*?>/gm,"")}),c.enviarOpcion(this)}),this.options.idcarrusel_opciones++,this._shouldScroll()||this._scrollToBottom()}else if("--transferir--"==e){$("#escribiendo").remove(),this._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">Lo siento, aún no se como ayudarlo con este tema, me encuentro en proceso de capacitación. Si deseas que te transfiera con un ejecutivo haz clic en el siguiente botón <a style="margin-top:5px;" href="#" class="goToChat">Hablar con Ejecutivo Jumbo</a></div></div>'),this._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived">'+this.getCurrentTime()+"</p></div>"),this._guardarEnBase("envio",'message=Lo siento, aún no se como ayudarlo con este tema, me encuentro en proceso de capacitación. Si deseas que te transfiera con un ejecutivo haz clic en el siguiente botón <a style="margin-top:5px;" href="#">Hablar con Ejecutivo Jumbo</a>'),this._guardarEnBase("historial",'message=<div class="chat-widget-message-container"><div class="chat-widget-message received">Lo siento, aún no se como ayudarlo con este tema, me encuentro en proceso de capacitación. Si deseas que te transfiera con un ejecutivo haz clic en el siguiente botón <a style="margin-top:5px;" href="#" class="goToChat">Hablar con Ejecutivo Jumbo</a></div></div><div class="chat-widget-message-container"><p class="timerecived">'+this.getCurrentTime()+"</p></div>"),this._shouldScroll()||this._scrollToBottom();c=this;$(".goToChat").on("click",function(){c.formularioTransferir()}),this.options.idmensaje++}else if("--transferir_btn--"==e)$("#escribiendo").remove(),this.formularioTransferir(),this.options.idmensaje++;else if(-1!=e.indexOf("--consultoOrdenEmail--"))e=e.replace("--consultoOrdenEmail--",""),this._consultaOrdenes(e);else if("--ofertas--"==e)this._consultaOfertas("recomendacion");else if("--ofertas_clic--"==e)this._consultaOfertas("clic_boton_ofertas");else if(-1!=e.indexOf("--consultoOrdenId--"))e=e.replace("--consultoOrdenId--",""),this._consultaOrden(e);else if(-1!=e.indexOf("--test--"))e=e.replace("--test--",""),this._consultaProducto(e);else if(-1!=e.indexOf("--testpromo--"))e=e.replace("--testpromo--",""),this._consultaPromocion(e);else if(-1!=e.indexOf("--testborracookie--"))e=e.replace("--testborracookie--",""),this.eliminarcookie();else if(-1!=e.indexOf("--testpuntos--"))e=e.replace("--testpuntos--",""),this._consultaPuntos(e);else if(-1!=e.indexOf("--rating--")&&(e=e.replace("--rating--",""),t=1),""!=e&&(this._guardarEnBase("recibo","message="+e),this._guardarEnBase("historial",'message=<div class="chat-widget-message-container"><p class="chat-widget-message received">'+e.replace('"','"')+'</p></div><div class="chat-widget-message-container"><p class="timerecived">'+this.getCurrentTime()+"</p></div>"),$("#escribiendo").remove(),this._messageLog.append('<div class="chat-widget-message-container"><p class="chat-widget-message received">'+e+"</p></div>"),this._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived">'+this.getCurrentTime()+"</p></div>"),this._shouldScroll()||this._scrollToBottom()),1==t&&1!=this.options.calificaron){$("#escribiendo").remove();i="";var o="";"undefined"!=typeof dataLayer&&void 0!==dataLayer[3]&&void 0!==dataLayer[3].visitorContactInfo&&(void 0!==dataLayer[3].visitorContactInfo[1]&&""!=dataLayer[3].visitorContactInfo[1]&&(i=dataLayer[3].visitorContactInfo[1]),void 0!==dataLayer[3].visitorContactInfo[2]&&""!=dataLayer[3].visitorContactInfo[2]&&(i+=" "+dataLayer[3].visitorContactInfo[2]),void 0!==dataLayer[3].visitorContactInfo[0]&&""!=dataLayer[3].visitorContactInfo[0]&&(o=dataLayer[3].visitorContactInfo[0])),this._messageLog.append('<div style="" class="chat-widget-message-container"><div class="chat-widget-message received"><fieldset style="margin-bottom: 10px; text-align:center;" class="rating"><legend>Quisieras colaborar con mi entrenamiento? Como calificarías mi atención?</legend><leyend id="noCalifico" style="color:red;clear:both;width:100%;float:left;display:none;">Favor selecciona tu calificación</leyend><span class="rating"><input type="radio" id="star5" name="rating" value="5" /><label for="star5" title="Genial!">5 Estrellas</label><input type="radio" id="star4" name="rating" value="4" /><label for="star4" title="Muy buena">4 Estrellas</label>    <input type="radio" id="star3" name="rating" value="3" /><label for="star3" title="Buena">3 Estrellas</label>    <input type="radio" id="star2" name="rating" value="2" /><label for="star2" title="Algo ayudo">2 Estrellas</label>    <input type="radio" id="star1" name="rating" value="1" /><label for="star1" title="Perdida de tiempo">1 Estrella</label></span></fieldset><div id="divAdicionalRating" style="display:none"><input style="width:100%;padding:4px;margin-top:4px;padding-left:15px" name="nombre" placeholder="Nombre*" value="'+i+'"/><input style="width:100%;padding:4px;margin-top:4px;padding-left:15px" name="email" placeholder="Email*" value="'+o+'"/><input style="margin-top:4px;width:100%;padding:4px;padding-left:15px" name="telefono" placeholder="Telefono" /><textarea name="comentario" rows="3" data-min-rows="3" class="autoExpand" style="width:100%;padding-left:15px;padding-top:5px;margin-top:4px" placeholder="Ingresa el motivo de la calificación..." autocomplete="off"></textarea><button id="calificacionSend" class="calificacionBtn"><i style="margin-right: 5px; float: left; margin-left: 5px;"></i><label style="text-align: center;">ENVIAR</label></button></div></div></div>'),this._shouldScroll()||this._scrollToBottom();c=this;$(".rating").on("click",function(){"none"==$("#divAdicionalRating").css("display")&&($("#divAdicionalRating").show(),$(".chat-widget-message-log").scrollTop($(".chat-widget-message-log").prop("scrollHeight")))}),$(".calificacionBtn").on("click",function(){c.calificar()})}},getCurrentTime:function(){return(new Date).toLocaleTimeString().replace(/([\d]+:[\d]{2})(:[\d]{2})(.*)/,"$1$3")},eliminarcookie:function(){for(var e=document.cookie.split("; "),t=0;t<e.length;t++)for(var i=window.location.hostname.split(".");i.length>0;){var s=encodeURIComponent(e[t].split(";")[0].split("=")[0])+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; domain="+i.join(".")+" ;path=",c=location.pathname.split("/");for(document.cookie=s+"/";c.length>0;)document.cookie=s+c.join("/"),c.pop();i.shift()}location.reload()},_guardarEnBase:function(e,t){var i=this;window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status&&""!=this.responseText){var e=JSON.parse(this.responseText);if(void 0!==e.id)if(i.options.idChatActual=e.id,console.log(e),console.log("respuesta--id:"+i.options.idChatActual),void 0!==e.chat)i._messageLog.html(e.chat),$(".carruselOpciones").slick({nextArrow:'<i class="slick-next fa-chevron-right"></i>',prevArrow:'<i class="slick-prev fa-chevron-left"></i>'}),$("#escribiendo").remove(),i._scrollToBottom();else if(i._socket.readyState==i._socket.OPEN)i._socket.send(JSON.stringify({type:"message",message:"hola",session:i.options.idChatActual}));else{!function e(){console.log(i._socket.readyState),i._socket.readyState==i._socket.OPEN?i._socket.send(JSON.stringify({type:"message",message:"hola",session:i.options.idChatActual})):setTimeout(e,1500)}()}}};var s=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action="+e;s+="&idchat="+this.options.idChatActual,"historial"!=e&&null!=t&&(s+="&"+t),xmlhttp.open("POST",s,!0),xmlhttp.withCredentials=!0,xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),"historial"==e?xmlhttp.send(t):xmlhttp.send()},_consultaOrdenes:function(e){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");var t=this;xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);console.log(e);var i="";if($("#escribiendo").remove(),Object.keys(e.list).length>0){i="Encuentro las siguientes ordenes, haz clic en el numero de orden para brindarte mas información:<br>",i+='<table class="tblOrden">',i+='<tr style="padding:4px;font-weight:bold;background:rgba(241,23,20,1);color:#fff;"><td style="width:42%">Num</td><td style="width:30%">Fecha</td></tr>';for(var s=0;s<Object.keys(e.list).length;s++)i+='<tr class="ver_pedido" style="cursor:pointer;" idorden="'+e.list[s].orderId+'"><td>'+e.list[s].orderId+"</td>",i+="<td>"+t._formatDate(e.list[s].creationDate)+"</td>";i+="</table>"}else i="Lo siento, no encuentro ordenes recientes para su mail, por favor verifique que sea el mail correcto y este bien escrito. O digame su numero de pedido";t._guardarEnBase("envio","message="+i),t._guardarEnBase("historial",'message=<div class="chat-widget-message-container"><div class="chat-widget-message received">'+i+'</div></div><div class="chat-widget-message-container"><p class="timerecived">'+t.getCurrentTime()+"</p></div>"),t._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">'+i+"</div></div>"),t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived">'+t.getCurrentTime()+"</p></div>"),$(".ver_pedido").on("click",function(){console.log($(this).attr("idorden")),t._consultaOrden($(this).attr("idorden"))}),t._shouldScroll()||t._scrollToBottom()}};var i=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=consultarOrdenes&email="+e;xmlhttp.open("GET",i,!0),xmlhttp.withCredentials=!0,xmlhttp.send()},_consultaOrden:function(e){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");var t=this;xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);console.log(e);$("#escribiendo").remove(),t._guardarEnBase("envio","message="),t._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">'+e.respuesta+"</div></div>"),t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),t._shouldScroll()||t._scrollToBottom()}};var i=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=consultarOrden&ordenid="+e;xmlhttp.open("GET",i,!0),xmlhttp.withCredentials=!0,xmlhttp.send()},_consultaOfertas:function(e){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");var t=this;xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){for(var i=JSON.parse(this.responseText),s="",c='<div class="chat_producto_slider'+t.options.idcarrusel+' chat_producto_slider responsive" style="text-align:center">',o=[],a=0;a<Object.keys(i).length;a++){s+=i[a].productName.toLowerCase()+"<br>";var r=[];if(r.nombre=t.quitaacentos(i[a].productName.toLowerCase()),r.id=i[a].productId,r.precio=i[a].items[0].sellers[0].commertialOffer.Price,r.addtocartlink=i[a].items[0].sellers[0].addToCartLink,c+="<div>",c+="<a style='width:97%;' href='"+i[a].link+"'><img style='margin:auto;height:130px' src='"+i[a].items[0].images[0].imageUrl+"' /></a>",c+="<div class='info-description'>",c+="<h3 class='chatProductName'>"+r.nombre+" </h3>",console.log(i),i[a].items[0].sellers[0].commertialOffer.AvailableQuantity>0){i[a].items[0].sellers[0].commertialOffer.Price,i[a].items[0].sellers[0].commertialOffer.ListPrice;var n=i[a].items[0].sellers[0].commertialOffer.ListPrice,d=i[a].items[0].sellers[0].commertialOffer.Price;d<n&&(c+="<span class='txt-gris'>Precio Regular $"+n.toLocaleString()+"</span>"),c+="<span class='txt-verde'>Precio Ahora $<strong>"+d.toLocaleString()+"</strong></span>";for(var p=[],l=0;l<Object.keys(i[a].items[0].sellers[0].commertialOffer.Teasers).length;l++)if(console.log(Object.keys(i[a].items[0].sellers[0].commertialOffer.Teasers).length),!(Object.keys(i[a].items[0].sellers[0].commertialOffer.Teasers).length<=0)&&(console.log(i[a].items[0].sellers[0].commertialOffer.Teasers),i[a].items[0].sellers[0].commertialOffer.Teasers[l]["<Effects>k__BackingField"]["<Parameters>k__BackingField"][0].includes("<Value>k__BackingField"))){var u=i[a].items[0].sellers[0].commertialOffer.Teasers[l]["<Name>k__BackingField"].split("-"),m=i[a].items[0].sellers[0].commertialOffer.Teasers[l]["<Effects>k__BackingField"]["<Parameters>k__BackingField"][0]["<Value>k__BackingField"],v=Math.round(i[a].items[0].sellers[0].commertialOffer.PriceWithoutDiscount-i[a].items[0].sellers[0].commertialOffer.PriceWithoutDiscount*(m/100));switch(v=v.toLocaleString(),u[0]){case"PCENCO":if(null==p.PCENCO){p.PCENCO=[],p.PCENCO.descuento=v,p.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+v+"</span></div>";break}if(null==p.PCENCO.descuento){p.PCENCO.descuento=v,p.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+v+"</span></div>";break}if(p.PCENCO.descuento<v){p.PCENCO.descuento=v,p.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+v+"</span></div>";break}case"VISA":if(null==p.VISA){p.VISA=[],p.VISA.descuento=v,p.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+v+"</span></div>";break}if(null==p.VISA.descuento){p.VISA.descuento=v,p.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+v+"</span></div>";break}if(p.VISA.descuento<v){p.VISA.descuento=v,p.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+v+"</span></div>";break}case"AMEX":if(null==p.AMEX){p.AMEX=[],p.AMEX.descuento=v,p.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+v+"</span></div>";break}if(null==p.AMEX.descuento){p.AMEX.descuento=v,p.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+v+"</span></div>";break}if(p.AMEX.descuento<v){p.AMEX.descuento=v,p.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+v+"</span></div>";break}case"COLP":if(null==p.COLP){p.COLP=[],p.COLP.descuento=v,p.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+v+"</span></div>";break}if(null==p.COLP.descuento){p.COLP.descuento=v,p.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+v+"</span></div>";break}if(p.COLP.descuento<v){p.COLP.descuento=v,p.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+v+"</span></div>";break}case"BBVA":if(null==p.BBVA){p.BBVA=[],p.BBVA.descuento=v,p.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+v+"</span></div>";break}if(null==p.BBVA.descuento){p.BBVA.descuento=v,p.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+v+"</span></div>";break}if(p.BBVA.descuento<v){p.BBVA.descuento=v,p.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+v+"</span></div>";break}case"AVAL":if(null==p.AVAL){p.AVAL=[],p.AVAL.descuento=v,p.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+v+"</span></div>";break}if(null==p.AVAL.descuento){p.AVAL.descuento=v,p.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+v+"</span></div>";break}if(p.AVAL.descuento<v){p.AVAL.descuento=v,p.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+v+"</span></div>";break}case"TCENCO24":if(null==p.TCENCO24){p.TCENCO24=[],p.TCENCO24.descuento=v,p.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(null==p.TCENCO24.descuento){p.TCENCO24.descuento=v,p.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(p.TCENCO24.descuento<v){p.TCENCO24.descuento=v,p.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}case"COD":if(null==p.COD){p.COD=[],p.COD.descuento=v,p.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+v+"</span></div>";break}if(null==p.COD.descuento){p.COD.descuento=v,p.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+v+"</span></div>";break}if(p.COD.descuento<v){p.COD.descuento=v,p.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+v+"</span></div>";break}case"TCENCO":if(null==p.TCENCO){p.TCENCO=[],p.TCENCO.descuento=v,p.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(null==p.TCENCO.descuento){p.TCENCO.descuento=v,p.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(p.TCENCO.descuento<v){p.TCENCO.descuento=v,p.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}case"BBOG":if(null==p.BBOG){p.BBOG=[],p.BBOG.descuento=v,p.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+v+"</span></div>";break}if(null==p.BBOG.descuento){p.BBOG.descuento=v,p.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+v+"</span></div>";break}if(p.BBOG.descuento<v){p.BBOG.descuento=v,p.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+v+"</span></div>";break}case"ITAU":if(null==p.ITAU){p.ITAU=[],p.ITAU.descuento=v,p.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+v+"</span></div>";break}if(null==p.ITAU.descuento){p.ITAU.descuento=v,p.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+v+"</span></div>";break}if(p.ITAU.descuento<v){p.ITAU.descuento=v,p.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+v+"</span></div>";break}case"MCARD":if(null==p.MCARD){p.MCARD=[],p.MCARD.descuento=v,p.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+v+"</span></div>";break}if(null==p.MCARD.descuento){p.MCARD.descuento=v,p.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+v+"</span></div>";break}if(p.MCARD.descuento<v){p.MCARD.descuento=v,p.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+v+"</span></div>";break}case"CVAL":null!=p.CVAL?null==p.CVAL.descuento?(p.CVAL.descuento=v,p.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+v+"</span></div>"):p.CVAL.descuento<v&&(p.CVAL.descuento=v,p.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+v+"</span></div>"):(p.CVAL=[],p.CVAL.descuento=v,p.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+v+"</span></div>")}}for(var _ in console.log(p),p)null!=p[_].contenido&&(c+=p[_].contenido);c+="<a class='btn btn-naranja chat_addtocart ' prod_nombre='"+r.nombre+"' prod_id='"+r.id+"' prod_precio='"+r.precio+"' prod_addtocartlink='"+r.addtocartlink+"' href='#'><i class='fa fa-shopping-cart' aria-hidden='true'></i><strong>&nbsp; Comprar</strong></a>",c+="<span class='line'></span>",c+="<div  class='flex-container'>",c+="<a href='"+i[a].link+"'class='btn btn-gris flex'><i class='fa fa-search-plus' aria-hidden='true'></i> <strong>  Ver Producto</strong></a>"}else c+='<div class="product-item__price product-item__no-stock prices-formatted"><div class="font-icn alert"></div><div class="text">Sin Stock</div></div>',c+="<div class='precio_oferta' style='color:#e8e6e4;'>-</div>",c+="<a href='"+i[a].link+"'class='btn btn-gris flex' style='margin: 4px auto !important;'><i class='fa fa-search-plus' aria-hidden='true'></i> <strong>  Ver Producto</strong></a>";c+="</div>",c+="</div>",c+="</div>",o.push({name:r.nombre,id:r.id,price:r.precio,brand:"",category:"",variant:"",list:"Chatbot Vista Productos",position:a})}c+="</div>",Object.keys(o).length>0?(t._guardarEnBase("recibo","message="+s),"undefined"!=typeof dataLayer&&dataLayer.push({event:"OfertasChatbot",origen:e,ecommerce:{currencyCode:"SOL",impressions:o}}),$("#escribiendo").remove(),t._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">'+c+"</div></div>"),t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>')):($("#escribiendo").remove(),t._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received"> Lo siento,este producto no se encuentra registrado.</div></div>'),t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>')),t._shouldScroll()||t._scrollToBottom(),$(".chat_producto_slider"+t.options.idcarrusel).slick({nextArrow:'<i class="slick-next fa-chevron-right"></i>',prevArrow:'<i class="slick-prev fa-chevron-left"></i>'}),t.options.idcarrusel++,$(".chat_addtocart").on("click",function(){var e=this.getAttribute("prod_nombre"),i=this.getAttribute("prod_id"),s=this.getAttribute("prod_precio"),c=this.getAttribute("prod_addtocartlink");t.agregarCarro(e,i,s,c)})}},$("#escribiendo").remove(),this._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">Voy a recomendarle algunas de nuestras mejores ofertas.</div></div>'),this._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),this._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),this._shouldScroll()||this._scrollToBottom();xmlhttp.open("GET"," https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=ofertas",!0),xmlhttp.withCredentials=!0,xmlhttp.send()},_consultaProducto:function(e,t){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");var i=this;xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText).productos,s="";console.log(t);for(var c='<div class="chat_producto_slider'+i.options.idcarrusel+' chat_producto_slider responsive" style="text-align:center">',o=[],a=0;a<Object.keys(t).length;a++){s+=t[a].nombre.toLowerCase()+"<br>";var r=[];if(r.nombre=i.quitaacentos(t[a].nombre.toLowerCase()),r.id=t[a].id,r.precio=t[a].precio,r.peciound=t[a].peciound,r.addtocartlink=t[a].agregaralcarro,c+="<div>",c+="<a style='width:97%;' href='"+t[a].link+"'><img style='margin:auto;margin:auto;height:130px' src='"+t[a].imagen+"' /></a>",c+="<div class='info-description'>",c+="<h3 class='chatProductName'>"+r.nombre+" </h3>",t[a].AvailableQuantity>0){t[a].listprecio;var n=t[a].listprecio,d=t[a].precio,p=t[a].peciound;d<n&&(c+="<span class='txt-gris'>Precio Regular $"+n.toLocaleString()+"</span>"),c+="<span class='txt-verde'>Precio Ahora $<strong>"+d.toLocaleString()+"</strong></span>",c+="<span class='txt-verde-precunidad'>"+p+"</span>";for(var l=[],u=0;u<Object.keys(t[a].sellers[0].commertialOffer.Teasers).length;u++)if(!(Object.keys(t[a].sellers[0].commertialOffer.Teasers).length<=0)){var m=t[a].sellers[0].commertialOffer.Teasers[u]["<Name>k__BackingField"].split("-"),v=t[a].sellers[0].commertialOffer.Teasers[u]["<Effects>k__BackingField"]["<Parameters>k__BackingField"][0]["<Value>k__BackingField"],_=Math.round(t[a].sellers[0].commertialOffer.PriceWithoutDiscount-t[a].sellers[0].commertialOffer.PriceWithoutDiscount*(v/100));switch(_=_.toLocaleString(),m[0]){case"PCENCO":if(null==l.PCENCO){l.PCENCO=[],l.PCENCO.descuento=_,l.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+_+"</span></div>";break}if(null==l.PCENCO.descuento){l.PCENCO.descuento=_,l.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+_+"</span></div>";break}if(l.PCENCO.descuento<_){l.PCENCO.descuento=_,l.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+_+"</span></div>";break}case"VISA":if(null==l.VISA){l.VISA=[],l.VISA.descuento=_,l.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+_+"</span></div>";break}if(null==l.VISA.descuento){l.VISA.descuento=_,l.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+_+"</span></div>";break}if(l.VISA.descuento<_){l.VISA.descuento=_,l.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+_+"</span></div>";break}case"AMEX":if(null==l.AMEX){l.AMEX=[],l.AMEX.descuento=_,l.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+_+"</span></div>";break}if(null==l.AMEX.descuento){l.AMEX.descuento=_,l.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+_+"</span></div>";break}if(l.AMEX.descuento<_){l.AMEX.descuento=_,l.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+_+"</span></div>";break}case"COLP":if(null==l.COLP){l.COLP=[],l.COLP.descuento=_,l.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+_+"</span></div>";break}if(null==l.COLP.descuento){l.COLP.descuento=_,l.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+_+"</span></div>";break}if(l.COLP.descuento<_){l.COLP.descuento=_,l.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+_+"</span></div>";break}case"BBVA":if(null==l.BBVA){l.BBVA=[],l.BBVA.descuento=_,l.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+_+"</span></div>";break}if(null==l.BBVA.descuento){l.BBVA.descuento=_,l.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+_+"</span></div>";break}if(l.BBVA.descuento<_){l.BBVA.descuento=_,l.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+_+"</span></div>";break}case"AVAL":if(null==l.AVAL){l.AVAL=[],l.AVAL.descuento=_,l.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+_+"</span></div>";break}if(null==l.AVAL.descuento){l.AVAL.descuento=_,l.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+_+"</span></div>";break}if(l.AVAL.descuento<_){l.AVAL.descuento=_,l.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+_+"</span></div>";break}case"TCENCO24":if(null==l.TCENCO24){l.TCENCO24=[],l.TCENCO24.descuento=_,l.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+_+"</span></div>";break}if(null==l.TCENCO24.descuento){l.TCENCO24.descuento=_,l.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+_+"</span></div>";break}if(l.TCENCO24.descuento<_){l.TCENCO24.descuento=_,l.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+_+"</span></div>";break}case"COD":if(null==l.COD){l.COD=[],l.COD.descuento=_,l.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+_+"</span></div>";break}if(null==l.COD.descuento){l.COD.descuento=_,l.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+_+"</span></div>";break}if(l.COD.descuento<_){l.COD.descuento=_,l.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+_+"</span></div>";break}case"TCENCO":if(null==l.TCENCO){l.TCENCO=[],l.TCENCO.descuento=_,l.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+_+"</span></div>";break}if(null==l.TCENCO.descuento){l.TCENCO.descuento=_,l.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+_+"</span></div>";break}if(l.TCENCO.descuento<_){l.TCENCO.descuento=_,l.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+_+"</span></div>";break}case"BBOG":if(null==l.BBOG){l.BBOG=[],l.BBOG.descuento=_,l.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+_+"</span></div>";break}if(null==l.BBOG.descuento){l.BBOG.descuento=_,l.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+_+"</span></div>";break}if(l.BBOG.descuento<_){l.BBOG.descuento=_,l.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+_+"</span></div>";break}case"ITAU":if(null==l.ITAU){l.ITAU=[],l.ITAU.descuento=_,l.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+_+"</span></div>";break}if(null==l.ITAU.descuento){l.ITAU.descuento=_,l.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+_+"</span></div>";break}if(l.ITAU.descuento<_){l.ITAU.descuento=_,l.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+_+"</span></div>";break}case"MCARD":if(null==l.MCARD){l.MCARD=[],l.MCARD.descuento=_,l.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+_+"</span></div>";break}if(null==l.MCARD.descuento){l.MCARD.descuento=_,l.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+_+"</span></div>";break}if(l.MCARD.descuento<_){l.MCARD.descuento=_,l.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+_+"</span></div>";break}case"CVAL":null!=l.CVAL?null==l.CVAL.descuento?(l.CVAL.descuento=_,l.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+_+"</span></div>"):l.CVAL.descuento<_&&(l.CVAL.descuento=_,l.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+_+"</span></div>"):(l.CVAL=[],l.CVAL.descuento=_,l.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+_+"</span></div>")}}for(var g in l)null!=l[g].contenido&&(c+=l[g].contenido);c+="<a class='btn btn-naranja chat_addtocart ' prod_nombre='"+r.nombre+"' prod_id='"+r.id+"' prod_precio='"+r.precio+"' prod_addtocartlink='"+r.addtocartlink+"' href='#'><i class='fa fa-shopping-cart' aria-hidden='true'></i><strong>&nbsp; Comprar</strong></a>",c+="<span class='line'></span>",c+="<div  class='flex-container'>",c+="<a href='"+t[a].link+"'class='btn btn-gris flex'><i class='fa fa-search-plus' aria-hidden='true'></i> <strong>  Ver Producto</strong></a>",c+="<a href='https://www.jumbo.com.ar/busca/?ft="+e+"' class='btn btn-gris'><i class='fa fa-shopping-basket' aria-hidden='true'></i> <strong>  Relacionados</strong></a>",c+="</div>"}else c+='<div class="product-item__price product-item__no-stock prices-formatted"><div class="font-icn alert"></div><div class="text">Sin Stock</div></div>',c+="<div class='precio_oferta' style='color:#e8e6e4;'>-</div>",c+="<span class='line'></span>",c+="<div class='flex-container'>",c+="<a href='"+t[a].link+"'class='btn btn-gris flex'><i class='fa fa-search-plus' aria-hidden='true'></i> <strong>  Ver Producto</strong></a>",c+="<a href='https://www.jumbo.com.ar/busca/?ft="+e+"' class='btn btn-gris'><i class='fa fa-shopping-basket' aria-hidden='true'></i> <strong>  Relacionados</strong></a>",c+="</div>";c+="</div>",c+="</div>",o.push({name:r.nombre,id:r.id,price:r.precio,brand:"",category:"",variant:"",list:"Chatbot Vista Productos",position:a})}c+="</div>",Object.keys(o).length>0?(i._guardarEnBase("recibo","message="+s),"undefined"!=typeof dataLayer&&dataLayer.push({event:"ConsultaProductoChatbot",consulta:e,ecommerce:{currencyCode:"PEN",impressions:o}}),$("#escribiendo").remove(),i._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">'+c+"</div></div>"),i._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>')):($("#escribiendo").remove(),i._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received"> Lo siento,este producto no se encuentra registrado.</div></div>'),i._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>')),i._shouldScroll()||i._scrollToBottom(),$(".chat_producto_slider"+i.options.idcarrusel).slick({nextArrow:'<i class="slick-next fa-chevron-right" style="right:-18px;"></i>',prevArrow:'<i class="slick-prev fa-chevron-left"></i>'}),i.options.idcarrusel++,$(".chat_addtocart").on("click",function(){var e=this.getAttribute("prod_nombre"),t=this.getAttribute("prod_id"),s=this.getAttribute("prod_precio"),c=this.getAttribute("prod_addtocartlink");i.agregarCarro(e,t,s,c)})}},$("#escribiendo").remove(),this._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">Por favor aguarde un momento mientras consulto el precio y stock del producto o algunos similares.</div></div>'),this._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),this._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),this._shouldScroll()||this._scrollToBottom(),"%20Dulce Pasion"==e&&(e="torta&fq=B:2211");var s=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=consultarProducto&producto="+e;xmlhttp.open("GET",s,!0),xmlhttp.withCredentials=!0,xmlhttp.send()},_consultaPuntos:function(){$("#escribiendo").remove();var e=this;if($(".chat-widget-message-log").append('<div class="chat-widget-message-container"><div style="background-color:#f5f4f4;" class="chat-widget-message received" id="cupones">Indicar Tipo de Documento para consulta:<p style="padding-bottom:5px;"></p><div style="background-color:#f5f4f4;"></div>Documento<input class="dni" style="padding:3px 2px 3px 2px;margin:4px 0 8px 0;width:100%" type="text" name="txtDni" indexDni="'+e.options.idFormPuntos+'" id="dnipuntos'+e.options.idFormPuntos+'"><button indexPuntos="'+e.options.idFormPuntos+'" style="margin-top:20px;border: 1px solid #FF0000;border-radius: 5px;" id="goToPuntos'+e.options.idFormPuntos+'"class="goToChat botonconsultar"><i style="margin-right: 5px; float: left; margin-left: 5px;"></i><label style="text-align: center;">Consultar</label></button></div></div>'),"undefined"!=typeof dataLayer&&void 0!==dataLayer[3]&&void 0!==dataLayer[3].visitorContactInfo&&(void 0!==dataLayer[3].visitorContactInfo[1]&&""!=dataLayer[3].visitorContactInfo[1]&&(nombrecli=dataLayer[3].visitorContactInfo[1]),void 0!==dataLayer[3].visitorContactInfo[2]&&""!=dataLayer[3].visitorContactInfo[2]&&(nombrecli+=" "+dataLayer[3].visitorContactInfo[2]),void 0!==dataLayer[3].visitorContactInfo[0]&&""!=dataLayer[3].visitorContactInfo[0])){emailcli=dataLayer[3].visitorContactInfo[0];var e=this;window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText);console.log(t),e.options.dnicliPuntos=t[0].document,$("#dnipuntos"+e.options.idFormPuntos).val(e.options.dnicliPuntos)}};var t="  https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=datosUsuario&email="+emailcli;xmlhttp.open("GET",t,!1),xmlhttp.withCredentials=!0,xmlhttp.send()}(e=this)._shouldScroll()||e._scrollToBottom();var i=e.options.idFormPuntos;console.log(i);$(this).attr("indexPuntos");$("#dnipuntos"+e.options.idFormPuntos).on("keydown",function(t){13==t.which&&($("#goToPuntos"+i).click(),console.log(e.options.idFormPuntos),console.log(i))}),$("#goToPuntos"+e.options.idFormPuntos).unbind("click"),$("#goToPuntos"+e.options.idFormPuntos).on("click",function(){var t=$(this).attr("indexPuntos");if(e._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),e._shouldScroll()||e._scrollToBottom(),$("#goToPuntos"+t).removeClass("goToChat"),""==$("#dnipuntos"+t).val())return $("#escribiendo").remove(),document.getElementById("dnipuntos"+t).style.background="red",void document.getElementById("dnipuntos"+t).setAttribute("onkeyup","this.style.background = 'white'");if($("#goToPuntos"+t).unbind("click"),$("#goToPuntos"+t).attr("disabled","disabled"),$("#dnipuntos"+t).attr("disabled","disabled"),$("#filtro"+t).attr("disabled","disabled"),""==e.options.dnicliPuntos){var i=$("#dnipuntos"+t).val();e._puntosId(i),console.log(i)}else{i=$("#dnipuntos"+t).val();e._puntosId(i),console.log(i)}}),e.options.idFormPuntos++},_puntosId:function(e){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");var t=this;xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var i=JSON.parse(this.responseText);if(console.log(i),null!=i.error)return $("#escribiendo").remove(),t._messageLog.append('<div class="chat-widget-message-container" style="margin-top: 3px;"><div class="chat-widget-message received " >'+i.error+"</div></div>"),void t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>');if("404"==i.internalCode)t._shouldScroll()||t._scrollToBottom(),$("#escribiendo").remove(),t._messageLog.append('<div class="chat-widget-message-container" style="margin-top: 3px;"><div class="chat-widget-message received " >No hay puntos bonus asociados al N° de Documento: <b>'+e+'</b> asegurese de que sea correcto<button style="margin-top:20px;border: 1px solid #FF0000;border-radius: 5px;" indexCorregirPuntos="'+t.options.idItentar+'"id="corregirpuntos'+t.options.idItentar+'"class="goToChat botonconsultar"><i style="margin-right: 5px; float: left; margin-left: 5px;"></i><label style="text-align: center;">Intentar nuevamente</label></button></div></div>'),t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),t._shouldScroll()||t._scrollToBottom(),console.log("boton"),$("#corregirpuntos"+t.options.idItentar).unbind("click"),$("#corregirpuntos"+t.options.idItentar).on("click",function(){var e=$(this).attr("indexCorregirPuntos");console.log("accion"),t._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),t._shouldScroll()||t._scrollToBottom(),$("#corregirpuntos"+e).unbind("click"),$("#corregirpuntos"+e).removeClass("goToChat"),$("#corregirpuntos"+e).attr("disabled","disabled"),t._consultaPuntos(),console.log("accion")}),t.options.idItentar++;else if("200"==i.internalCode){var s=i.payload.rewards,c=i.payload.rewardsToExpire,o=new Date,a=i.payload.expireDate,r="<div style='background: url(  https://widget-chatbot-colombia.mybluemix.net/anita/images/back.jpg) no-repeat; width: 225px; height: 152px; margin: auto;border-radius:10px; '>";r+="<h1 style='font-size: 21px; color: white ;text-align: center; margin: auto;padding-top: 20px;'>Actualmente tienes</h1>";if(new Date(a)<o)s=s-c;r+="<p  style='color: #eab949 ; text-align: center; font-size: 30px;  padding-top: 1px'><strong style='font-weight:700'>"+s.toLocaleString()+"</strong></p>",r+="<p  style='color:white ; text-align: center; margin-bottom: 15px;font-size: 18px; line-height:6px;'>puntos</p>",r+="<h1  style='font-size: 11px; margin-top: 5px; color: white ; margin-left: 20px; text-align: center;'>por vencer al "+a+":</h1>",r+="<p style='color: white ; text-align: center; font-size: 19px; margin-left:10px;'><strong style='font-weight:600;'>"+c.toLocaleString()+'</strong><span style="font-size:13px; margin-top:6px;">Pts.</span></p>',r+="</div>",$("#escribiendo").remove(),t._messageLog.append('<div class="chat-widget-message-container" style="margin-top: 3px;"><div class="chat-widget-message received" style="width:100%;">'+r.toLocaleString()+"</div></div>"),t._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),t._shouldScroll()||t._scrollToBottom(),setTimeout(function(){t._messageLog.append('<div class="chat-widget-message-container" style="margin-top:3px;"><div class="chat-widget-message received">dime, puedo ayudarte en algo mas?</div></div>'),t._shouldScroll()||(console.log("scroll"),t._scrollToBottom())},2e3)}}};var i=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=consultarPuntos&documentId="+e;console.log(i),xmlhttp.open("GET",i,!0),xmlhttp.withCredentials=!0,xmlhttp.send()},_consultaPromocion:function(){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");var e=this;xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText);console.log(t);var i="";$("#escribiendo").remove(),$(".divopt").remove(),$("conf").remove(),$(".chat-widget-message").remove(),$("#pagin").remove();"<div class='divOptionButton' style='text-align:center'>Seleciona Por Favor si Tienes Algunos de Estos Medios de Pago y Confirma tu Consulta</div>","<div class='inline'><a class='divopt activobtn cenco' id='TCENCO-' href='#'>Tarjeta Cencosud</a></div>","<div class='inline'><a class='divopt activobtn' id='AVAL-' href='#'>Tarjeta Grupo Aval</a></div>","<div class='inline'><a class='divopt activobtn' id='BBOG-' href='#'>Tarjeta Banco Bogota</a></div>","<div class='inline'><a class='divopt activobtn' id='BBVA-' href='#'>Tarjeta BBVA</a></div>","<div class='inline'><a class='divopt activobtn' id='COD-' href='#'>Tarjeta Codensa</a></div>","<div class='inline'><a class='divopt activobtn' id='ITAU-' href='#'>Tarjeta Itau</a></div>","<div class='confirmar confirmarbtn'><a class='conf ' href='#'>Confirmar</a></div>","</div>",e._messageLog.append("<div class='chat-widget-message received contenedor '><div class='divOptionButton' style='text-align:center'>Seleciona Por Favor si Tienes Algunos de Estos Medios de Pago y Confirma tu Consulta</div><div class='inline'><a class='divopt activobtn cenco' id='TCENCO-' href='#'>Tarjeta Cencosud</a></div><div class='inline'><a class='divopt activobtn' id='AVAL-' href='#'>Tarjeta Grupo Aval</a></div><div class='inline'><a class='divopt activobtn' id='BBOG-' href='#'>Tarjeta Banco Bogota</a></div><div class='inline'><a class='divopt activobtn' id='BBVA-' href='#'>Tarjeta BBVA</a></div><div class='inline'><a class='divopt activobtn' id='COD-' href='#'>Tarjeta Codensa</a></div><div class='inline'><a class='divopt activobtn' id='ITAU-' href='#'>Tarjeta Itau</a></div><div class='confirmar confirmarbtn'><a class='conf ' href='#'>Confirmar</a></div></div>"),e._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),$(".chat-widget-message-log"+e.options.idcarrusel).slick({nextArrow:'<i class="slick-next fa-chevron-right"></i>',prevArrow:'<i class="slick-prev fa-chevron-left"></i>',slidesToShow:3}),e.options.idcarrusel++,e._shouldScroll()||e._scrollToBottom(),$(".activobtn").unbind("click"),$(".activobtn").on("click",function(){$(this).is("[disabled]")||("TCENCO-"==this.id&&(-1!=i.indexOf("TCENCO-")?($("#"+this.id).removeClass("current"),i=i.replace("TCENCO-",""),console.log(i)):(i+=this.id+"",$("#"+this.id).addClass("current"))),"AVAL-"==this.id&&(-1!=i.indexOf("AVAL-")?($("#"+this.id).removeClass("current"),i=i.replace("AVAL-",""),console.log(i)):(i+=this.id+"",$("#"+this.id).addClass("current"),console.log("entro else"),console.log(i))),"BBOG-"==this.id&&(-1!=i.indexOf("BBOG-")?($("#"+this.id).removeClass("current"),i=i.replace("BBOG-",""),console.log(i)):(i+=this.id+"",$("#"+this.id).addClass("current"),console.log("entro else"),console.log(i))),"BBVA-"==this.id&&(-1!=i.indexOf("BBVA-")?($("#"+this.id).removeClass("current"),i=i.replace("BBVA-",""),console.log(i)):(i+=this.id,$("#"+this.id).addClass("current"),console.log("entro else"),console.log(i))),"COD-"==this.id&&(-1!=i.indexOf("COD-")?($("#"+this.id).removeClass("current"),i=i.replace("COD-",""),console.log(i)):(i+=this.id,$("#"+this.id).addClass("current"),console.log("entro else"),console.log(i))),"ITAU-"==this.id&&(-1!=i.indexOf("ITAU-")?($("#"+this.id).removeClass("current"),i=i.replace("ITAU-",""),console.log(i)):(i+=this.id,$("#"+this.id).addClass("current"),console.log("entro else"),console.log(i))))}),$(".confirmarbtn").unbind("click"),$(".confirmarbtn").on("click",function(){if(!$(this).is("[disabled]")){var s=[],c=["TCENCO","AVAL","BBVA","BBOG","COD","ITAU"];i.split("-").forEach(function(e,t){c=c.filter(function(t){return t!==e})}),console.log(c);for(var o=0;o<Object.keys(t.items).length;o++){var a=!0;if(c.forEach(function(e,i){-1!=t.items[o].name.indexOf(e)&&(a=!1)}),a&&-1!=t.items[o].description.indexOf("*")){const e=/\*.*\*/g,i=t.items[o].description;let c;for(;null!==(c=e.exec(i));)c.index===e.lastIndex&&e.lastIndex++,c.forEach(function(e,i){e=e.replace(/\*/g,"");var c=new Date;fechainit=t.items[o].beginDate,fechaend=t.items[o].endDate,fechainit=new Date(fechainit),fechaend=new Date(fechaend),c>=fechainit&&c<=fechaend&&(console.log(t),s.push({id:t.items[o].idCalculatorConfiguration,description:e})),$(".activobtn").attr("disabled","disabled"),$(".confirmarbtn").attr("disabled","disabled")})}}var r="<p class='chat-widget-message received'>Haz click en una de nuestras promociones para ver los productos con descuentos.</p>";e._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),r+="<div class='chat-widget-message received'>";for(var n=0;n<Object.keys(s).length;n++)r+="<div class='line-content'><a id='"+s[n].id+"' class='divopt cs search-product'  href='#'>"+s[n].description+"</a></div>";r+="</div>",e._messageLog.append(r);"</ul>",e._messageLog.append('<ul id="pagin" class="cs"></ul>'),e._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),pageSize=4;var d=$(".line-content").length/pageSize;for(o=0;o<d;o++)$("#pagin").append('<li><a class="paginacion" href="#">'+(o+1)+"</a></li> ");$("#pagin li").first().find("a").addClass("current"),showPage=function(e){$(".line-content").hide(),$(".line-content").each(function(t){t>=pageSize*(e-1)&&t<pageSize*e&&$(this).show()})},showPage(1),$("#pagin li a").click(function(){$("#pagin li a").removeClass("current"),$(this).addClass("current"),showPage(parseInt($(this).text()))}),e._shouldScroll()||e._scrollToBottom(),$(".search-product").on("click",function(){e._consultaPromocionesProducto(this),$(this).addClass("current"),$(this).attr("disabled","disabled")})}})}};xmlhttp.open("GET"," https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=consultarPromociones",!0),xmlhttp.withCredentials=!0,xmlhttp.send()},_consultaPromocionesProducto:function(e,t){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");var i=this;xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){console.log(this.responseText);var e=JSON.parse(this.responseText),s=(JSON.parse(this.responseText),e.productos);e.card;if(Object.keys(s).length<=0)return $("#escribiendo").remove(),void i._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">No existen aun productos asociados a esta promocion.</div></div>');for(var c="",o='<div class="chat_producto_slider'+i.options.idcarrusel+' chat_producto_slider responsive" style="text-align:center">',a=[],r=0;r<Object.keys(s).length;r++){c+=s[r].productName.toLowerCase()+"<br>";var n=[];if(s[r].items[0].sellers[0].commertialOffer.AvailableQuantity>0){n.nombre=i.quitaacentos(s[r].productName.toLowerCase()),n.id=s[r].productId,n.precio=s[r].items[0].sellers[0].commertialOffer.Price,n.addtocartlink=s[r].items[0].sellers[0].addToCartLink,o+="<div>",o+="<a style='width:97%;' href='"+s[r].link+"'><img style='margin:auto;height:130px' src='"+s[r].items[0].images[0].imageUrl+"' /></a>",o+="<div class='info-description'>",o+="<h3 class='chatProductName'>"+n.nombre+" </h3>";var d=s[r].items[0].sellers[0].commertialOffer.ListPrice,p=s[r].items[0].sellers[0].commertialOffer.Price;p<d&&(o+="<span class='txt-gris'>Precio Regular $"+d.toLocaleString()+"</span>"),o+="<span class='txt-verde'>Precio Ahora $<strong>"+p.toLocaleString()+"</strong></span>";for(var l=[],u=0;u<Object.keys(s[r].items[0].sellers[0].commertialOffer.Teasers).length;u++)if(!(Object.keys(s[r].items[0].sellers[0].commertialOffer.Teasers).length<=0)){console.log(Object.keys(s[r].items[0].sellers[0].commertialOffer.Teasers).length);var m=s[r].items[0].sellers[0].commertialOffer.Teasers[u]["<Name>k__BackingField"].split("-"),v=Math.round(s[r].items[0].sellers[0].commertialOffer.PriceWithoutDiscount-s[r].items[0].sellers[0].commertialOffer.PriceWithoutDiscount*(m[1]/100));switch(v=v.toLocaleString(),m[0]){case"PCENCO":if(null==l.PCENCO){l.PCENCO=[],l.PCENCO.descuento=v,l.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+v+"</span></div>";break}if(null==l.PCENCO.descuento){l.PCENCO.descuento=v,l.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+v+"</span></div>";break}if(l.PCENCO.descuento<v){l.PCENCO.descuento=v,l.PCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--puntos-cencosud-price"><span class="product-prices__value" style="color: #4616da;">$'+v+"</span></div>";break}case"VISA":if(null==l.VISA){l.VISA=[],l.VISA.descuento=v,l.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+v+"</span></div>";break}if(null==l.VISA.descuento){l.VISA.descuento=v,l.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+v+"</span></div>";break}if(l.VISA.descuento<v){l.VISA.descuento=v,l.VISA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--visa-price"><span class="product-prices__value" style="color: #2f3690;">$'+v+"</span></div>";break}case"AMEX":if(null==l.AMEX){l.AMEX=[],l.AMEX.descuento=v,l.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+v+"</span></div>";break}if(null==l.AMEX.descuento){l.AMEX.descuento=v,l.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+v+"</span></div>";break}if(l.AMEX.descuento<v){l.AMEX.descuento=v,l.AMEX.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--american-price"><span class="product-prices__value" style="color: #43d2ea;">$'+v+"</span></div>";break}case"COLP":if(null==l.COLP){l.COLP=[],l.COLP.descuento=v,l.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+v+"</span></div>";break}if(null==l.COLP.descuento){l.COLP.descuento=v,l.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+v+"</span></div>";break}if(l.COLP.descuento<v){l.COLP.descuento=v,l.COLP.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--colpatria-price"><span class="product-prices__value" style="color: #f72222;">$'+v+"</span></div>";break}case"BBVA":if(null==l.BBVA){l.BBVA=[],l.BBVA.descuento=v,l.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+v+"</span></div>";break}if(null==l.BBVA.descuento){l.BBVA.descuento=v,l.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+v+"</span></div>";break}if(l.BBVA.descuento<v){l.BBVA.descuento=v,l.BBVA.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--bbva-price"><span class="product-prices__value" style="color: #195fc2;">$'+v+"</span></div>";break}case"AVAL":if(null==l.AVAL){l.AVAL=[],l.AVAL.descuento=v,l.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+v+"</span></div>";break}if(null==l.AVAL.descuento){l.AVAL.descuento=v,l.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+v+"</span></div>";break}if(l.AVAL.descuento<v){l.AVAL.descuento=v,l.AVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--aval-price"><span class="product-prices__value" style="color: #1234b5;">$'+v+"</span></div>";break}case"TCENCO24":if(null==l.TCENCO24){l.TCENCO24=[],l.TCENCO24.descuento=v,l.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(null==l.TCENCO24.descuento){l.TCENCO24.descuento=v,l.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(l.TCENCO24.descuento<v){l.TCENCO24.descuento=v,l.TCENCO24.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}case"COD":if(null==l.COD){l.COD=[],l.COD.descuento=v,l.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+v+"</span></div>";break}if(null==l.COD.descuento){l.COD.descuento=v,l.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+v+"</span></div>";break}if(l.COD.descuento<v){l.COD.descuento=v,l.COD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--codensa-price"><span class="product-prices__value" style="color: #dac644;">$'+v+"</span></div>";break}case"TCENCO":if(null==l.TCENCO){l.TCENCO=[],l.TCENCO.descuento=v,l.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(null==l.TCENCO.descuento){l.TCENCO.descuento=v,l.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}if(l.TCENCO.descuento<v){l.TCENCO.descuento=v,l.TCENCO.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--cencosud-price"><span class="product-prices__value" style="color: #FF9700;">$'+v+"</span></div>";break}case"BBOG":if(null==l.BBOG){l.BBOG=[],l.BBOG.descuento=v,l.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+v+"</span></div>";break}if(null==l.BBOG.descuento){l.BBOG.descuento=v,l.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+v+"</span></div>";break}if(l.BBOG.descuento<v){l.BBOG.descuento=v,l.BBOG.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-bta-price"><span class="product-prices__value" style="color: #005d93;">$'+v+"</span></div>";break}case"ITAU":if(null==l.ITAU){l.ITAU=[],l.ITAU.descuento=v,l.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+v+"</span></div>";break}if(null==l.ITAU.descuento){l.ITAU.descuento=v,l.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+v+"</span></div>";break}if(l.ITAU.descuento<v){l.ITAU.descuento=v,l.ITAU.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--banco-itau-price"><span class="product-prices__value" style="color: #100c73;">$'+v+"</span></div>";break}case"MCARD":if(null==l.MCARD){l.MCARD=[],l.MCARD.descuento=v,l.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+v+"</span></div>";break}if(null==l.MCARD.descuento){l.MCARD.descuento=v,l.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+v+"</span></div>";break}if(l.MCARD.descuento<v){l.MCARD.descuento=v,l.MCARD.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--master-card-price"><span class="product-prices__value" style="color: #eb001b;">$'+v+"</span></div>";break}case"CVAL":null!=l.CVAL?null==l.CVAL.descuento?(l.CVAL.descuento=v,l.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+v+"</span></div>"):l.CVAL.descuento<v&&(l.CVAL.descuento=v,l.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+v+"</span></div>"):(l.CVAL=[],l.CVAL.descuento=v,l.CVAL.contenido='<div class="product-prices__price product-prices__price--promo-price product-prices__price--credi-valores-price"><span class="product-prices__value" style="color: #002240;">$'+v+"</span></div>")}}for(var _ in console.log(l),l)null!=l[_].contenido&&(o+=l[_].contenido);o+="<a class='btn btn-naranja chat_addtocart ' prod_nombre='"+n.nombre+"' prod_id='"+n.id+"' prod_precio='"+n.precio+"' prod_addtocartlink='"+n.addtocartlink+"' href='#'><i class='fa fa-shopping-cart' aria-hidden='true'></i><strong>Comprar</strong></a>",o+="<span class='line'></span>",o+="<div  class='flex-container'>",o+="<a href='"+s[r].link+"'class='btn btn-gris flex'><i class='fa fa-search-plus' aria-hidden='true'></i> <strong>  Ver Producto</strong></a>",o+="<a href='https://www.tiendasjumbo.co/busca/?ft="+t+"' class='btn btn-gris'><i class='fa fa-shopping-basket' aria-hidden='true'></i> <strong>  Relacionados</strong></a>",o+="</div>",o+="</div>",o+="</div>",a.push({name:n.nombre,id:n.id,price:n.precio,brand:"",category:"",variant:"",list:"Chatbot Vista Productos",position:r})}}o+="</div>",Object.keys(a).length>0?(i._guardarEnBase("recibo","message="+c),"undefined"!=typeof dataLayer&&dataLayer.push({event:"ConsultaProductoChatbot",consulta:t,ecommerce:{currencyCode:"PEN",impressions:a}}),$("#escribiendo").remove(),i._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">'+o+"</div></div>"),i._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>')):($("#escribiendo").remove(),i._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">No existen productos asociados a esta Promocion.</div></div>'),i._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>')),i._shouldScroll()||i._scrollToBottom(),$(".chat_producto_slider"+i.options.idcarrusel).slick({nextArrow:'<i class="slick-next fa-chevron-right"></i>',prevArrow:'<i class="slick-prev fa-chevron-left"></i>'}),i.options.idcarrusel++,$(".chat_addtocart").on("click",function(){var e=this.getAttribute("prod_nombre"),t=this.getAttribute("prod_id"),s=this.getAttribute("prod_precio"),c=this.getAttribute("prod_addtocartlink");i.agregarCarro(e,t,s,c)})}},$("#escribiendo").remove(),this._messageLog.append('<div class="chat-widget-message-container"><div class="chat-widget-message received">Por favor aguarde un momento mientras consulto  los  productos asociados a esta Promocion.</div></div>'),this._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),this._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),this._shouldScroll()||this._scrollToBottom(),"%20Dulce Pasion"==t&&(t="torta&fq=B:2211");var s=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=consultarProductoPromo&idPromo="+e.id;console.log(s),xmlhttp.open("GET",s,!0),xmlhttp.withCredentials=!0,xmlhttp.send()},_agregarPunto:function(e){var t=/(\d+)(\d{2})/;return String(e).replace(/^\d+/,function(e){for(;t.test(e);)e=e.replace(t,"$1.$2");return e})},_formatDate:function(e){if(null==e)return"SIN INFORMACIÓN";var t=new Date(e),i=""+(t.getMonth()+1),s=""+t.getDate(),c=t.getFullYear();return i.length<2&&(i="0"+i),s.length<2&&(s="0"+s),[s,i,c].join("-")},quitaacentos:function(t){return á="a",é="e",í="i",ó="o",ú="u",ä="a",ë="e",ï="i",ö="o",ü="u",acentos=/[áéíóúäëïöü]/g,t=t.replace(/("|')/g,""),t.replace(acentos,function($1){return eval($1)})},enviarOpcion:function(e){this.sendMessage(e.innerHTML.replace(/<(?:.|\n)*?>/gm,""),"opcion")},formularioTransferir:function(){var e="",t="",i="",s="";if("undefined"!=typeof dataLayer&&void 0!==dataLayer[3]&&void 0!==dataLayer[3].visitorContactInfo&&(void 0!==dataLayer[3].visitorContactInfo[1]&&""!=dataLayer[3].visitorContactInfo[1]&&(e=dataLayer[3].visitorContactInfo[1]),void 0!==dataLayer[3].visitorContactInfo[2]&&""!=dataLayer[3].visitorContactInfo[2]&&(e+=" "+dataLayer[3].visitorContactInfo[2]),void 0!==dataLayer[3].visitorContactInfo[0]&&""!=dataLayer[3].visitorContactInfo[0])){t=dataLayer[3].visitorContactInfo[0];var c=this;window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);console.log(e),i=e[0].homePhone,s=e[0].document}};var o=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=datosUsuario&email="+t;xmlhttp.open("GET",o,!1),xmlhttp.withCredentials=!0,xmlhttp.send()}var a=this.options.idmensaje;this.options.idmensaje++,$(".carruselOpciones").remove(),$(".chat-widget-message-log").append('<div class="chat-widget-message-container"><div style="background-color:#f5f4f4;" class="chat-widget-message received" id="transferidoDiv">Completa el formulario y te transfiero con un Ejecutivo Jumbo.<p style="padding-bottom:5px;"></p><input style="display:none;" id="id" value="'+this.options.idChatActual+'" />Nombre*<input style="padding:3px 2px 3px 2px;margin:4px 0 8px 0;width:100%" type="text" name="txtNombre" id="nombre" value="'+e+'">Teléfono<br/><input style="padding:3px 2px 3px 2px;margin:4px 0 8px 0;width:100%" type="text" id="telefono" name="txtTelefono" value="'+i+'">Documento de Identidad*<input style="padding:3px 2px 3px 2px;margin:4px 0 8px 0;width:100%" type="text" name="txtDni" id="dni" value="'+s+'">Email*<input style="padding:3px 2px 3px 2px;margin:4px 0 8px 0;width:100%" type="text" name="email" id="email" value="'+t+'"><button style="margin-top:20px;border: 1px solid #119F3D;border-radius: 5px;" class="goToChat"><i style="margin-right: 5px; float: left; margin-left: 5px;"></i><label style="text-align: center;">ENTRAR</label></button></div></div>'),$(".chat-widget-message-log").scrollTop($(".chat-widget-message-log").prop("scrollHeight"));c=this;$(".goToChat").on("click",function(){c.chatHumano(a)})},chatHumano:function(e){var t=document.querySelector('input[name="rating'+e+'"]:checked'),i=0;null!=t&&(i=t.value);var s=document.getElementById("nombre").value,c=document.getElementById("telefono").value,o=!0,a=document.getElementById("dni").value,r=document.getElementById("email").value;if(""==s&&(document.getElementById("nombre").style.background="red",document.getElementById("nombre").setAttribute("onkeyup","this.style.background = 'white'")),""!=c){/[0-9]/.test(c)||(o=!1,document.getElementById("telefono").style.background="red",document.getElementById("telefono").setAttribute("onkeyup","this.style.background = 'white'"))}""==a&&(document.getElementById("dni").style.background="red",document.getElementById("dni").setAttribute("onkeyup","this.style.background = 'white'"));var n=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(""!=r&&n.test(r)||(document.getElementById("email").style.background="red",document.getElementById("email").setAttribute("onkeyup","this.style.background = 'white'")),""!=s&&""!=a&&""!=r&&n.test(r)&&0!=o){""==c&&(c=0),window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);console.log(e);e.id;"undefined"!=typeof dataLayer&&dataLayer.push({event:"transferidoChatHumano"})}};var d=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=transferir",p="nombre="+s+"&telefono="+c+"&dni="+a+"&email="+r+"&score="+i;null!=p&&(d+="&"+p),xmlhttp.open("GET",d,!0),xmlhttp.withCredentials=!0,xmlhttp.send()}},calificar:function(){var e=document.querySelector('input[name="rating"]:checked'),t=0,i=document.querySelector('input[name="nombre"]').value,s=document.querySelector('input[name="telefono"]').value,c=document.querySelector('input[name="email"]').value,o=1;if(""==i&&(document.querySelector('input[name="nombre"]').style.background="red",document.querySelector('input[name="nombre"]').setAttribute("onkeyup","this.style.background = 'white'")),""==c?(document.querySelector('input[name="email"]').style.background="red",document.querySelector('input[name="email"]').setAttribute("onkeyup","this.style.background = 'white'")):/^[-\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\.){1,125}[A-Z]{2,63}$/i.test(c)||(document.querySelector('input[name="email"]').style.background="red",document.querySelector('input[name="email"]').setAttribute("onkeyup","this.style.background = 'white'"),o=0),null!=e?(t=e.value,document.getElementById("noCalifico").style.display="none"):document.getElementById("noCalifico").style.display="block",""!=i&&""!=t&&""!=c&&0!=o){document.getElementById("calificacionSend").disabled=!0,document.querySelector('input[name="rating"]').disabled=!0,$(".received input[type=text]").disabled=!0;var a=this;window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&($("#escribiendo").remove(),$(".chat-widget-message-log").append('<div style="padding-top:5px" class="chat-widget-message-container"><div class="chat-widget-message received">Muchas gracias, tu clasificación ayuda con mi entrenamiento</div></div>'),a._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),a._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),$(".chat-widget-message-log").scrollTop($(".chat-widget-message-log").prop("scrollHeight")),a.options.calificaron=!0,a.sleep(2e3),1!=a.options.calificación?(a._hideChat(),$("#escribiendo").remove()):($("#escribiendo").remove(),a._hideChat()),console.log(this.responseText))},this._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>');var r=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=rating",n="score="+t;n+="&nombre="+i,n+="&telefono="+s,n+="&email="+c,null!=(n+="&comentario="+document.querySelector('textarea[name="comentario"]').value)&&(r+="&"+n),xmlhttp.open("GET",r,!0),xmlhttp.withCredentials=!0,xmlhttp.send()}},calificarCerrar:function(){var e=document.querySelector('input[name="rating2"]:checked'),t=0,i=document.querySelector('input[name="nombre"]').value,s=document.querySelector('input[name="telefono"]').value,c=document.querySelector('input[name="email"]').value,o=1;if(""==i&&(document.querySelector('input[name="nombre"]').style.background="red",document.querySelector('input[name="nombre"]').setAttribute("onkeyup","this.style.background = 'white'")),""==c?(document.querySelector('input[name="email"]').style.background="red",document.querySelector('input[name="email"]').setAttribute("onkeyup","this.style.background = 'white'")):/^[-\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\.){1,125}[A-Z]{2,63}$/i.test(c)||(document.querySelector('input[name="email"]').style.background="red",document.querySelector('input[name="email"]').setAttribute("onkeyup","this.style.background = 'white'"),o=0),null!=e?(t=e.value,document.getElementById("noCalifico").style.display="none"):document.getElementById("noCalifico").style.display="block",""!=i&&""!=t&&""!=c&&0!=o){document.getElementById("calificacionSend2").disabled=!0,document.querySelector('input[name="rating2"]').disabled=!0,$(".received input[type=text]").disabled=!0;var a=this;window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&($("#escribiendo").remove(),$(".chat-widget-message-log").append('<div style="padding-top:5px" class="chat-widget-message-container"><div class="chat-widget-message received">Muchas gracias, tu clasificación ayuda con mi entrenamiento</div></div>'),a._messageLog.append('<div class="chat-widget-message-container"><p class="timerecived"></p></div>'),a._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),$(".chat-widget-message-log").scrollTop($(".chat-widget-message-log").prop("scrollHeight")),$("#escribiendo").remove(),$(".calificar-cerrar").remove(),a._hideChat(),a.options.calificaron=!0)},this._messageLog.append('<div id="escribiendo" class="bounce"><div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>');var r=" https://widget-chatbot-colombia.mybluemix.net/anita/backend/db.php?action=rating",n="score="+t;n+="&nombre="+i,n+="&telefono="+s,n+="&email="+c,null!=(n+="&comentario="+document.querySelector('textarea[name="comentario"]').value)&&(r+="&"+n),xmlhttp.open("GET",r,!0),xmlhttp.withCredentials=!0,xmlhttp.send()}},verProductosPedido:function(e){"Ver Productos"==e.text?(document.getElementById("tblOrden").style.display="block",e.text="Ocultar Productos"):(document.getElementById("tblOrden").style.display="none",e.text="Ver Productos")},agregarCarro:function(e,t,i,s){"undefined"!=typeof dataLayer&&dataLayer.push({event:"addToCartChat",ecommerce:{currencyCode:"PEN",add:{products:[{name:e,id:t,price:i,brand:"",category:"",variant:"",quantity:1}]}}}),window.location.href=s},sleep:function(e){for(var t=(new Date).getTime(),i=0;i<1e7&&!((new Date).getTime()-t>e);i++);},_restartChat:function(){$("#chat-widget").show(),console.log("restartchat")},_removeChat:function(){$("#chat-widget").hide(),console.log("removechat")},bindEvent:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)}});